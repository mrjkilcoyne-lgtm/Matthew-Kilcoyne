const h = React.createElement;
const { useState, useEffect, useRef, useCallback, useMemo } = React;

// ============================================================
// SVG ICON COMPONENTS
// ============================================================

function IconShield(props) {
  return h('svg', { xmlns: 'http://www.w3.org/2000/svg', width: props.size || 24, height: props.size || 24, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2, strokeLinecap: 'round', strokeLinejoin: 'round', className: props.className || '' },
    h('path', { d: 'M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z' })
  );
}

function IconScan(props) {
  return h('svg', { xmlns: 'http://www.w3.org/2000/svg', width: props.size || 24, height: props.size || 24, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2, strokeLinecap: 'round', strokeLinejoin: 'round', className: props.className || '' },
    h('path', { d: 'M3 7V5a2 2 0 0 1 2-2h2' }),
    h('path', { d: 'M17 3h2a2 2 0 0 1 2 2v2' }),
    h('path', { d: 'M21 17v2a2 2 0 0 1-2 2h-2' }),
    h('path', { d: 'M7 21H5a2 2 0 0 1-2-2v-2' }),
    h('line', { x1: 7, y1: 12, x2: 17, y2: 12 })
  );
}

function IconGlobe(props) {
  return h('svg', { xmlns: 'http://www.w3.org/2000/svg', width: props.size || 24, height: props.size || 24, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2, strokeLinecap: 'round', strokeLinejoin: 'round', className: props.className || '' },
    h('circle', { cx: 12, cy: 12, r: 10 }),
    h('line', { x1: 2, y1: 12, x2: 22, y2: 12 }),
    h('path', { d: 'M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10A15.3 15.3 0 0 1 12 2z' })
  );
}

function IconLock(props) {
  return h('svg', { xmlns: 'http://www.w3.org/2000/svg', width: props.size || 24, height: props.size || 24, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2, strokeLinecap: 'round', strokeLinejoin: 'round', className: props.className || '' },
    h('rect', { x: 3, y: 11, width: 18, height: 11, rx: 2, ry: 2 }),
    h('path', { d: 'M7 11V7a5 5 0 0 1 10 0v4' })
  );
}

function IconFile(props) {
  return h('svg', { xmlns: 'http://www.w3.org/2000/svg', width: props.size || 24, height: props.size || 24, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2, strokeLinecap: 'round', strokeLinejoin: 'round', className: props.className || '' },
    h('path', { d: 'M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z' }),
    h('polyline', { points: '14 2 14 8 20 8' })
  );
}

function IconSmartphone(props) {
  return h('svg', { xmlns: 'http://www.w3.org/2000/svg', width: props.size || 24, height: props.size || 24, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2, strokeLinecap: 'round', strokeLinejoin: 'round', className: props.className || '' },
    h('rect', { x: 5, y: 2, width: 14, height: 20, rx: 2, ry: 2 }),
    h('line', { x1: 12, y1: 18, x2: 12.01, y2: 18 })
  );
}

function IconWifi(props) {
  return h('svg', { xmlns: 'http://www.w3.org/2000/svg', width: props.size || 24, height: props.size || 24, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2, strokeLinecap: 'round', strokeLinejoin: 'round', className: props.className || '' },
    h('path', { d: 'M5 12.55a11 11 0 0 1 14.08 0' }),
    h('path', { d: 'M1.42 9a16 16 0 0 1 21.16 0' }),
    h('path', { d: 'M8.53 16.11a6 6 0 0 1 6.95 0' }),
    h('line', { x1: 12, y1: 20, x2: 12.01, y2: 20 })
  );
}

function IconAlertTriangle(props) {
  return h('svg', { xmlns: 'http://www.w3.org/2000/svg', width: props.size || 24, height: props.size || 24, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2, strokeLinecap: 'round', strokeLinejoin: 'round', className: props.className || '' },
    h('path', { d: 'M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z' }),
    h('line', { x1: 12, y1: 9, x2: 12, y2: 13 }),
    h('line', { x1: 12, y1: 17, x2: 12.01, y2: 17 })
  );
}

function IconMessageSquare(props) {
  return h('svg', { xmlns: 'http://www.w3.org/2000/svg', width: props.size || 24, height: props.size || 24, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2, strokeLinecap: 'round', strokeLinejoin: 'round', className: props.className || '' },
    h('path', { d: 'M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z' })
  );
}

function IconBarChart(props) {
  return h('svg', { xmlns: 'http://www.w3.org/2000/svg', width: props.size || 24, height: props.size || 24, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2, strokeLinecap: 'round', strokeLinejoin: 'round', className: props.className || '' },
    h('line', { x1: 12, y1: 20, x2: 12, y2: 10 }),
    h('line', { x1: 18, y1: 20, x2: 18, y2: 4 }),
    h('line', { x1: 6, y1: 20, x2: 6, y2: 16 })
  );
}

function IconMenu(props) {
  return h('svg', { xmlns: 'http://www.w3.org/2000/svg', width: props.size || 24, height: props.size || 24, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2, strokeLinecap: 'round', strokeLinejoin: 'round', className: props.className || '' },
    h('line', { x1: 3, y1: 12, x2: 21, y2: 12 }),
    h('line', { x1: 3, y1: 6, x2: 21, y2: 6 }),
    h('line', { x1: 3, y1: 18, x2: 21, y2: 18 })
  );
}

function IconX(props) {
  return h('svg', { xmlns: 'http://www.w3.org/2000/svg', width: props.size || 24, height: props.size || 24, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2, strokeLinecap: 'round', strokeLinejoin: 'round', className: props.className || '' },
    h('line', { x1: 18, y1: 6, x2: 6, y2: 18 }),
    h('line', { x1: 6, y1: 6, x2: 18, y2: 18 })
  );
}

function IconSearch(props) {
  return h('svg', { xmlns: 'http://www.w3.org/2000/svg', width: props.size || 24, height: props.size || 24, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2, strokeLinecap: 'round', strokeLinejoin: 'round', className: props.className || '' },
    h('circle', { cx: 11, cy: 11, r: 8 }),
    h('line', { x1: 21, y1: 21, x2: 16.65, y2: 16.65 })
  );
}

function IconCheckCircle(props) {
  return h('svg', { xmlns: 'http://www.w3.org/2000/svg', width: props.size || 24, height: props.size || 24, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2, strokeLinecap: 'round', strokeLinejoin: 'round', className: props.className || '' },
    h('path', { d: 'M22 11.08V12a10 10 0 1 1-5.93-9.14' }),
    h('polyline', { points: '22 4 12 14.01 9 11.01' })
  );
}

function IconXCircle(props) {
  return h('svg', { xmlns: 'http://www.w3.org/2000/svg', width: props.size || 24, height: props.size || 24, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2, strokeLinecap: 'round', strokeLinejoin: 'round', className: props.className || '' },
    h('circle', { cx: 12, cy: 12, r: 10 }),
    h('line', { x1: 15, y1: 9, x2: 9, y2: 15 }),
    h('line', { x1: 9, y1: 9, x2: 15, y2: 15 })
  );
}

function IconExternalLink(props) {
  return h('svg', { xmlns: 'http://www.w3.org/2000/svg', width: props.size || 24, height: props.size || 24, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2, strokeLinecap: 'round', strokeLinejoin: 'round', className: props.className || '' },
    h('path', { d: 'M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6' }),
    h('polyline', { points: '15 3 21 3 21 9' }),
    h('line', { x1: 10, y1: 14, x2: 21, y2: 3 })
  );
}

function IconSend(props) {
  return h('svg', { xmlns: 'http://www.w3.org/2000/svg', width: props.size || 24, height: props.size || 24, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2, strokeLinecap: 'round', strokeLinejoin: 'round', className: props.className || '' },
    h('line', { x1: 22, y1: 2, x2: 11, y2: 13 }),
    h('polygon', { points: '22 2 15 22 11 13 2 9 22 2' })
  );
}

function IconTrash(props) {
  return h('svg', { xmlns: 'http://www.w3.org/2000/svg', width: props.size || 24, height: props.size || 24, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2, strokeLinecap: 'round', strokeLinejoin: 'round', className: props.className || '' },
    h('polyline', { points: '3 6 5 6 21 6' }),
    h('path', { d: 'M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2' })
  );
}

function IconTrophy(props) {
  return h('svg', { xmlns: 'http://www.w3.org/2000/svg', width: props.size || 24, height: props.size || 24, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2, strokeLinecap: 'round', strokeLinejoin: 'round', className: props.className || '' },
    h('path', { d: 'M6 9H4.5a2.5 2.5 0 0 1 0-5H6' }),
    h('path', { d: 'M18 9h1.5a2.5 2.5 0 0 0 0-5H18' }),
    h('path', { d: 'M4 22h16' }),
    h('path', { d: 'M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20 7 22' }),
    h('path', { d: 'M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20 17 22' }),
    h('path', { d: 'M18 2H6v7a6 6 0 0 0 12 0V2Z' })
  );
}

function IconArrowRight(props) {
  return h('svg', { xmlns: 'http://www.w3.org/2000/svg', width: props.size || 24, height: props.size || 24, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2, strokeLinecap: 'round', strokeLinejoin: 'round', className: props.className || '' },
    h('line', { x1: 5, y1: 12, x2: 19, y2: 12 }),
    h('polyline', { points: '12 5 19 12 12 19' })
  );
}

function IconBug(props) {
  return h('svg', { xmlns: 'http://www.w3.org/2000/svg', width: props.size || 24, height: props.size || 24, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2, strokeLinecap: 'round', strokeLinejoin: 'round', className: props.className || '' },
    h('rect', { x: 8, y: 6, width: 8, height: 14, rx: 4 }),
    h('path', { d: 'M19 9h-2' }),
    h('path', { d: 'M7 9H5' }),
    h('path', { d: 'M19 15h-2' }),
    h('path', { d: 'M7 15H5' }),
    h('path', { d: 'M16 4l1-2' }),
    h('path', { d: 'M8 4L7 2' }),
    h('path', { d: 'M12 6V2' })
  );
}

function IconTrendingUp(props) {
  return h('svg', { xmlns: 'http://www.w3.org/2000/svg', width: props.size || 24, height: props.size || 24, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2, strokeLinecap: 'round', strokeLinejoin: 'round', className: props.className || '' },
    h('polyline', { points: '23 6 13.5 15.5 8.5 10.5 1 18' }),
    h('polyline', { points: '17 6 23 6 23 12' })
  );
}

function IconTrendingDown(props) {
  return h('svg', { xmlns: 'http://www.w3.org/2000/svg', width: props.size || 24, height: props.size || 24, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2, strokeLinecap: 'round', strokeLinejoin: 'round', className: props.className || '' },
    h('polyline', { points: '23 18 13.5 8.5 8.5 13.5 1 6' }),
    h('polyline', { points: '17 18 23 18 23 12' })
  );
}

function IconClock(props) {
  return h('svg', { xmlns: 'http://www.w3.org/2000/svg', width: props.size || 24, height: props.size || 24, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2, strokeLinecap: 'round', strokeLinejoin: 'round', className: props.className || '' },
    h('circle', { cx: 12, cy: 12, r: 10 }),
    h('polyline', { points: '12 6 12 12 16 14' })
  );
}

function IconUpload(props) {
  return h('svg', { xmlns: 'http://www.w3.org/2000/svg', width: props.size || 24, height: props.size || 24, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2, strokeLinecap: 'round', strokeLinejoin: 'round', className: props.className || '' },
    h('path', { d: 'M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4' }),
    h('polyline', { points: '17 8 12 3 7 8' }),
    h('line', { x1: 12, y1: 3, x2: 12, y2: 15 })
  );
}

function IconHash(props) {
  return h('svg', { xmlns: 'http://www.w3.org/2000/svg', width: props.size || 24, height: props.size || 24, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2, strokeLinecap: 'round', strokeLinejoin: 'round', className: props.className || '' },
    h('line', { x1: 4, y1: 9, x2: 20, y2: 9 }),
    h('line', { x1: 4, y1: 15, x2: 20, y2: 15 }),
    h('line', { x1: 10, y1: 3, x2: 8, y2: 21 }),
    h('line', { x1: 16, y1: 3, x2: 14, y2: 21 })
  );
}

function IconRadio(props) {
  return h('svg', { xmlns: 'http://www.w3.org/2000/svg', width: props.size || 24, height: props.size || 24, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2, strokeLinecap: 'round', strokeLinejoin: 'round', className: props.className || '' },
    h('circle', { cx: 12, cy: 12, r: 2 }),
    h('path', { d: 'M16.24 7.76a6 6 0 0 1 0 8.49' }),
    h('path', { d: 'M7.76 16.24a6 6 0 0 1 0-8.49' }),
    h('path', { d: 'M19.07 4.93a10 10 0 0 1 0 14.14' }),
    h('path', { d: 'M4.93 19.07a10 10 0 0 1 0-14.14' })
  );
}

function IconSparkles(props) {
  return h('svg', { xmlns: 'http://www.w3.org/2000/svg', width: props.size || 24, height: props.size || 24, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2, strokeLinecap: 'round', strokeLinejoin: 'round', className: props.className || '' },
    h('path', { d: 'M12 3l1.5 5.5L19 10l-5.5 1.5L12 17l-1.5-5.5L5 10l5.5-1.5L12 3z' }),
    h('path', { d: 'M19 15l.88 2.12L22 18l-2.12.88L19 21l-.88-2.12L16 18l2.12-.88L19 15z' })
  );
}

function IconUser(props) {
  return h('svg', { xmlns: 'http://www.w3.org/2000/svg', width: props.size || 24, height: props.size || 24, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2, strokeLinecap: 'round', strokeLinejoin: 'round', className: props.className || '' },
    h('path', { d: 'M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2' }),
    h('circle', { cx: 12, cy: 7, r: 4 })
  );
}

function IconBot(props) {
  return h('svg', { xmlns: 'http://www.w3.org/2000/svg', width: props.size || 24, height: props.size || 24, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2, strokeLinecap: 'round', strokeLinejoin: 'round', className: props.className || '' },
    h('rect', { x: 3, y: 11, width: 18, height: 10, rx: 2 }),
    h('circle', { cx: 12, cy: 5, r: 2 }),
    h('path', { d: 'M12 7v4' }),
    h('line', { x1: 8, y1: 16, x2: 8, y2: 16 }),
    h('line', { x1: 16, y1: 16, x2: 16, y2: 16 })
  );
}


// ============================================================
// CVE DATABASE
// ============================================================

var CVE_DATABASE = [
  {
    id: 'CVE-2024-53104',
    title: 'USB Video Class Privilege Escalation',
    description: 'An out-of-bounds write vulnerability in the USB Video Class driver that allows physical attackers to escalate privileges. The flaw exists in the uvc_parse_format function, which improperly parses UVC_VS_UNDEFINED frames.',
    severity: 'HIGH',
    cvss: 7.8,
    affected: 'Linux Kernel (Android devices)',
    published: '2024-12-02',
    patched: '2025-02-01',
    exploitedInWild: true,
    vector: 'Physical / Local',
    category: 'Privilege Escalation'
  },
  {
    id: 'CVE-2024-53197',
    title: 'ALSA USB Audio Driver Out-of-Bounds Access',
    description: 'An out-of-bounds access vulnerability in the Linux kernel ALSA USB audio driver. Exploitation can lead to privilege escalation on affected Android devices through crafted USB devices.',
    severity: 'HIGH',
    cvss: 7.8,
    affected: 'Linux Kernel (Android)',
    published: '2024-12-27',
    patched: '2025-04-01',
    exploitedInWild: true,
    vector: 'Physical / Local',
    category: 'Privilege Escalation'
  },
  {
    id: 'CVE-2025-27363',
    title: 'FreeType Font Rendering RCE',
    description: 'An out-of-bounds write in FreeType versions 2.13.0 and below when parsing TrueType GX and variable font files. Can lead to arbitrary code execution when processing malicious font files.',
    severity: 'CRITICAL',
    cvss: 8.1,
    affected: 'FreeType <= 2.13.0 (Android, Linux, many platforms)',
    published: '2025-03-11',
    patched: '2025-05-01',
    exploitedInWild: true,
    vector: 'Network',
    category: 'Remote Code Execution'
  },
  {
    id: 'CVE-2024-43093',
    title: 'Android Framework Privilege Escalation',
    description: 'A privilege escalation vulnerability in the Android Framework component ExternalStorageProvider.java that allows unauthorized access to sensitive directories including Android/data, Android/obb, and Android/sandbox.',
    severity: 'HIGH',
    cvss: 7.8,
    affected: 'Android 12, 13, 14, 15',
    published: '2024-11-04',
    patched: '2024-11-01',
    exploitedInWild: true,
    vector: 'Local',
    category: 'Privilege Escalation'
  },
  {
    id: 'CVE-2024-43047',
    title: 'Qualcomm DSP Use-After-Free',
    description: 'A use-after-free vulnerability in Qualcomm DSP Services (FastRPC driver) allowing memory corruption from HLOS. Can be exploited to achieve arbitrary code execution at the kernel level.',
    severity: 'HIGH',
    cvss: 7.8,
    affected: 'Qualcomm chipsets (Snapdragon SoCs)',
    published: '2024-10-07',
    patched: '2024-11-01',
    exploitedInWild: true,
    vector: 'Local',
    category: 'Memory Corruption'
  },
  {
    id: 'CVE-2024-36971',
    title: 'Linux Kernel Network Route UAF',
    description: 'A use-after-free flaw in the Linux kernel network route management. The vulnerability allows changing nexthop of a route without proper locking, enabling local privilege escalation.',
    severity: 'HIGH',
    cvss: 7.8,
    affected: 'Linux Kernel (Android)',
    published: '2024-06-10',
    patched: '2024-08-01',
    exploitedInWild: true,
    vector: 'Local',
    category: 'Privilege Escalation'
  },
  {
    id: 'CVE-2024-32896',
    title: 'Pixel Firmware Privilege Escalation',
    description: 'A logic error in Pixel firmware that allows privilege escalation. Requires user interaction for exploitation but no additional privileges. Initially patched for Pixel, later applied to broader Android.',
    severity: 'HIGH',
    cvss: 7.8,
    affected: 'Google Pixel (later broader Android)',
    published: '2024-06-13',
    patched: '2024-09-01',
    exploitedInWild: true,
    vector: 'Local',
    category: 'Privilege Escalation'
  },
  {
    id: 'CVE-2023-40088',
    title: 'Android Bluetooth RCE',
    description: 'A remote code execution vulnerability in Android Bluetooth (com_android_bluetooth_btservice_AdapterService.cpp). Leads to RCE with no additional execution privileges or user interaction needed.',
    severity: 'CRITICAL',
    cvss: 8.8,
    affected: 'Android 11, 12, 12L, 13, 14',
    published: '2023-12-04',
    patched: '2023-12-01',
    exploitedInWild: false,
    vector: 'Adjacent Network',
    category: 'Remote Code Execution'
  },
  {
    id: 'CVE-2023-4863',
    title: 'WebP Heap Buffer Overflow',
    description: 'A heap buffer overflow in libwebp via a crafted WebP image. Affects Chrome, Firefox, and all Android apps using the system WebP decoder. Used in NSO Group Pegasus exploit chain.',
    severity: 'CRITICAL',
    cvss: 8.8,
    affected: 'libwebp, Chrome, Firefox, Android',
    published: '2023-09-11',
    patched: '2023-09-01',
    exploitedInWild: true,
    vector: 'Network',
    category: 'Remote Code Execution'
  },
  {
    id: 'CVE-2023-21036',
    title: 'aCropalypse - Pixel Screenshot Data Leak',
    description: 'The Pixel Markup tool (screenshot editor) fails to properly truncate PNG files after cropping, leaving original image data recoverable. Allows recovery of cropped-out sensitive content.',
    severity: 'MEDIUM',
    cvss: 5.5,
    affected: 'Google Pixel (Markup tool)',
    published: '2023-03-20',
    patched: '2023-03-01',
    exploitedInWild: false,
    vector: 'Network',
    category: 'Information Disclosure'
  },
  {
    id: 'CVE-2024-0044',
    title: 'Android Run-As Arbitrary Package Access',
    description: 'A vulnerability in Androids run-as command that allows any app to run as any other app through command injection in package names, achieving access to other apps sandbox data.',
    severity: 'HIGH',
    cvss: 7.8,
    affected: 'Android 12, 13, 14',
    published: '2024-03-18',
    patched: '2024-04-01',
    exploitedInWild: false,
    vector: 'Local',
    category: 'Privilege Escalation'
  },
  {
    id: 'CVE-2023-45779',
    title: 'APEX Module Signing Bypass',
    description: 'Multiple Android OEMs sign APEX modules with publicly available test keys, allowing attackers to push malicious updates to platform-level components enabling persistent privilege escalation.',
    severity: 'HIGH',
    cvss: 7.8,
    affected: 'Multiple Android OEMs',
    published: '2023-12-13',
    patched: '2023-12-01',
    exploitedInWild: false,
    vector: 'Local',
    category: 'Privilege Escalation'
  }
];

// ============================================================
// DEVICE DATABASE
// ============================================================

var DEVICE_DATABASE = [
  { name: 'Google Pixel 9 Pro', brand: 'Google', os: 'Android 15', securityPatch: '2025-02-05', chipset: 'Tensor G4', updateFrequency: 'Monthly', updateYears: 7, encryptionType: 'File-based (AES-256)', biometrics: 'Fingerprint, Face Unlock', securityScore: 95, titanChip: true, vpnBuiltIn: true },
  { name: 'Google Pixel 9', brand: 'Google', os: 'Android 15', securityPatch: '2025-02-05', chipset: 'Tensor G4', updateFrequency: 'Monthly', updateYears: 7, encryptionType: 'File-based (AES-256)', biometrics: 'Fingerprint', securityScore: 93, titanChip: true, vpnBuiltIn: true },
  { name: 'Google Pixel 8 Pro', brand: 'Google', os: 'Android 15', securityPatch: '2025-02-05', chipset: 'Tensor G3', updateFrequency: 'Monthly', updateYears: 7, encryptionType: 'File-based (AES-256)', biometrics: 'Fingerprint, Face Unlock', securityScore: 93, titanChip: true, vpnBuiltIn: true },
  { name: 'Google Pixel 8', brand: 'Google', os: 'Android 14', securityPatch: '2025-01-05', chipset: 'Tensor G3', updateFrequency: 'Monthly', updateYears: 7, encryptionType: 'File-based (AES-256)', biometrics: 'Fingerprint', securityScore: 91, titanChip: true, vpnBuiltIn: true },
  { name: 'Google Pixel 7a', brand: 'Google', os: 'Android 14', securityPatch: '2025-01-05', chipset: 'Tensor G2', updateFrequency: 'Monthly', updateYears: 5, encryptionType: 'File-based (AES-256)', biometrics: 'Fingerprint', securityScore: 88, titanChip: true, vpnBuiltIn: true },
  { name: 'Samsung Galaxy S25 Ultra', brand: 'Samsung', os: 'Android 15 (One UI 7)', securityPatch: '2025-02-01', chipset: 'Snapdragon 8 Elite', updateFrequency: 'Monthly', updateYears: 7, encryptionType: 'File-based (AES-256)', biometrics: 'Fingerprint, Face Unlock', securityScore: 92, titanChip: false, vpnBuiltIn: false },
  { name: 'Samsung Galaxy S25', brand: 'Samsung', os: 'Android 15 (One UI 7)', securityPatch: '2025-02-01', chipset: 'Snapdragon 8 Elite', updateFrequency: 'Monthly', updateYears: 7, encryptionType: 'File-based (AES-256)', biometrics: 'Fingerprint', securityScore: 90, titanChip: false, vpnBuiltIn: false },
  { name: 'Samsung Galaxy S24 Ultra', brand: 'Samsung', os: 'Android 15 (One UI 7)', securityPatch: '2025-01-01', chipset: 'Snapdragon 8 Gen 3', updateFrequency: 'Monthly', updateYears: 7, encryptionType: 'File-based (AES-256)', biometrics: 'Fingerprint, Face Unlock', securityScore: 91, titanChip: false, vpnBuiltIn: false },
  { name: 'Samsung Galaxy S24', brand: 'Samsung', os: 'Android 14 (One UI 6.1)', securityPatch: '2025-01-01', chipset: 'Exynos 2400', updateFrequency: 'Monthly', updateYears: 7, encryptionType: 'File-based (AES-256)', biometrics: 'Fingerprint', securityScore: 88, titanChip: false, vpnBuiltIn: false },
  { name: 'Samsung Galaxy Z Fold 6', brand: 'Samsung', os: 'Android 14 (One UI 6.1)', securityPatch: '2025-01-01', chipset: 'Snapdragon 8 Gen 3', updateFrequency: 'Monthly', updateYears: 7, encryptionType: 'File-based (AES-256)', biometrics: 'Fingerprint', securityScore: 89, titanChip: false, vpnBuiltIn: false },
  { name: 'Samsung Galaxy A55', brand: 'Samsung', os: 'Android 14 (One UI 6.1)', securityPatch: '2024-12-01', chipset: 'Exynos 1480', updateFrequency: 'Quarterly', updateYears: 4, encryptionType: 'File-based (AES-256)', biometrics: 'Fingerprint', securityScore: 78, titanChip: false, vpnBuiltIn: false },
  { name: 'Apple iPhone 16 Pro Max', brand: 'Apple', os: 'iOS 18', securityPatch: '2025-02-10', chipset: 'A18 Pro', updateFrequency: 'Monthly', updateYears: 7, encryptionType: 'Hardware AES-256-XTS', biometrics: 'Face ID', securityScore: 96, titanChip: false, vpnBuiltIn: false },
  { name: 'Apple iPhone 16 Pro', brand: 'Apple', os: 'iOS 18', securityPatch: '2025-02-10', chipset: 'A18 Pro', updateFrequency: 'Monthly', updateYears: 7, encryptionType: 'Hardware AES-256-XTS', biometrics: 'Face ID', securityScore: 96, titanChip: false, vpnBuiltIn: false },
  { name: 'Apple iPhone 16', brand: 'Apple', os: 'iOS 18', securityPatch: '2025-02-10', chipset: 'A18', updateFrequency: 'Monthly', updateYears: 7, encryptionType: 'Hardware AES-256-XTS', biometrics: 'Face ID', securityScore: 95, titanChip: false, vpnBuiltIn: false },
  { name: 'Apple iPhone 15 Pro', brand: 'Apple', os: 'iOS 18', securityPatch: '2025-02-10', chipset: 'A17 Pro', updateFrequency: 'Monthly', updateYears: 6, encryptionType: 'Hardware AES-256-XTS', biometrics: 'Face ID', securityScore: 94, titanChip: false, vpnBuiltIn: false },
  { name: 'Apple iPhone 15', brand: 'Apple', os: 'iOS 18', securityPatch: '2025-01-27', chipset: 'A16', updateFrequency: 'Monthly', updateYears: 6, encryptionType: 'Hardware AES-256-XTS', biometrics: 'Face ID', securityScore: 93, titanChip: false, vpnBuiltIn: false },
  { name: 'Apple iPhone SE (2022)', brand: 'Apple', os: 'iOS 18', securityPatch: '2025-01-27', chipset: 'A15', updateFrequency: 'Monthly', updateYears: 5, encryptionType: 'Hardware AES-256-XTS', biometrics: 'Touch ID', securityScore: 88, titanChip: false, vpnBuiltIn: false },
  { name: 'OnePlus 13', brand: 'OnePlus', os: 'Android 15 (OxygenOS 15)', securityPatch: '2025-01-05', chipset: 'Snapdragon 8 Elite', updateFrequency: 'Bi-monthly', updateYears: 4, encryptionType: 'File-based (AES-256)', biometrics: 'Fingerprint', securityScore: 82, titanChip: false, vpnBuiltIn: false },
  { name: 'OnePlus 12', brand: 'OnePlus', os: 'Android 14 (OxygenOS 14)', securityPatch: '2024-12-05', chipset: 'Snapdragon 8 Gen 3', updateFrequency: 'Bi-monthly', updateYears: 4, encryptionType: 'File-based (AES-256)', biometrics: 'Fingerprint', securityScore: 79, titanChip: false, vpnBuiltIn: false },
  { name: 'OnePlus Nord 4', brand: 'OnePlus', os: 'Android 14 (OxygenOS 14)', securityPatch: '2024-11-05', chipset: 'Snapdragon 7+ Gen 3', updateFrequency: 'Quarterly', updateYears: 3, encryptionType: 'File-based (AES-256)', biometrics: 'Fingerprint', securityScore: 72, titanChip: false, vpnBuiltIn: false },
  { name: 'Xiaomi 14 Ultra', brand: 'Xiaomi', os: 'Android 14 (HyperOS)', securityPatch: '2024-12-01', chipset: 'Snapdragon 8 Gen 3', updateFrequency: 'Quarterly', updateYears: 3, encryptionType: 'File-based (AES-256)', biometrics: 'Fingerprint, Face Unlock', securityScore: 76, titanChip: false, vpnBuiltIn: false },
  { name: 'Xiaomi 14', brand: 'Xiaomi', os: 'Android 14 (HyperOS)', securityPatch: '2024-11-01', chipset: 'Snapdragon 8 Gen 3', updateFrequency: 'Quarterly', updateYears: 3, encryptionType: 'File-based (AES-256)', biometrics: 'Fingerprint', securityScore: 74, titanChip: false, vpnBuiltIn: false },
  { name: 'Xiaomi Redmi Note 13 Pro', brand: 'Xiaomi', os: 'Android 13 (MIUI 14)', securityPatch: '2024-09-01', chipset: 'Snapdragon 7s Gen 2', updateFrequency: 'Quarterly', updateYears: 2, encryptionType: 'File-based (AES-256)', biometrics: 'Fingerprint', securityScore: 62, titanChip: false, vpnBuiltIn: false },
  { name: 'Nothing Phone (2)', brand: 'Nothing', os: 'Android 14 (Nothing OS 2.5)', securityPatch: '2024-10-05', chipset: 'Snapdragon 8+ Gen 1', updateFrequency: 'Bi-monthly', updateYears: 3, encryptionType: 'File-based (AES-256)', biometrics: 'Fingerprint', securityScore: 73, titanChip: false, vpnBuiltIn: false },
  { name: 'Motorola Edge 50 Pro', brand: 'Motorola', os: 'Android 14', securityPatch: '2024-10-01', chipset: 'Snapdragon 7 Gen 3', updateFrequency: 'Quarterly', updateYears: 3, encryptionType: 'File-based (AES-256)', biometrics: 'Fingerprint', securityScore: 70, titanChip: false, vpnBuiltIn: false },
  { name: 'Sony Xperia 1 VI', brand: 'Sony', os: 'Android 14', securityPatch: '2024-11-01', chipset: 'Snapdragon 8 Gen 3', updateFrequency: 'Quarterly', updateYears: 3, encryptionType: 'File-based (AES-256)', biometrics: 'Fingerprint', securityScore: 75, titanChip: false, vpnBuiltIn: false }
];


// ============================================================
// SECURITY SERVICES
// ============================================================

var SecurityServices = {
  // URL Scanner
  scanUrl: function(url) {
    var result = { url: url, safe: true, threats: [], score: 100, details: {} };
    var lowerUrl = url.toLowerCase();
    
    // Check protocol
    if (lowerUrl.startsWith('http://')) {
      result.threats.push({ type: 'NO_HTTPS', severity: 'MEDIUM', message: 'URL uses HTTP instead of HTTPS - data transmitted in plaintext' });
      result.score -= 20;
    }

    // Suspicious TLDs
    var suspiciousTlds = ['.tk', '.ml', '.ga', '.cf', '.gq', '.xyz', '.top', '.buzz', '.club', '.work', '.zip', '.mov'];
    suspiciousTlds.forEach(function(tld) {
      if (lowerUrl.includes(tld + '/') || lowerUrl.endsWith(tld)) {
        result.threats.push({ type: 'SUSPICIOUS_TLD', severity: 'MEDIUM', message: 'Domain uses suspicious TLD: ' + tld });
        result.score -= 15;
      }
    });

    // IP-based URLs
    if (/https?:\/\/\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}/.test(lowerUrl)) {
      result.threats.push({ type: 'IP_URL', severity: 'HIGH', message: 'URL uses IP address instead of domain - common in phishing' });
      result.score -= 30;
    }

    // Lookalike brand detection
    var brands = [
      { name: 'Google', pattern: /g[o0]{2}g[l1]e|g00gle|googl3/i },
      { name: 'Facebook', pattern: /faceb[o0]{2}k|facebo0k|facebok/i },
      { name: 'Apple', pattern: /app[l1]e|4pple|appl3/i },
      { name: 'Amazon', pattern: /amaz[o0]n|amaz0n|amazom/i },
      { name: 'Microsoft', pattern: /micr[o0]s[o0]ft|mircosoft|microsft/i },
      { name: 'PayPal', pattern: /paypa[l1]|paypa1|paypai/i },
      { name: 'Netflix', pattern: /netf[l1]ix|netfl1x|netfiix/i },
      { name: 'Bank of America', pattern: /bankofamer[i1]ca|bank0famerica/i }
    ];

    brands.forEach(function(brand) {
      try {
        var hostname = new URL(url).hostname;
        if (brand.pattern.test(hostname) && !hostname.includes(brand.name.toLowerCase().replace(/\s/g, ''))) {
          result.threats.push({ type: 'BRAND_IMPERSONATION', severity: 'CRITICAL', message: 'Possible ' + brand.name + ' impersonation detected' });
          result.score -= 40;
        }
      } catch(e) {}
    });

    // Excessive subdomains
    try {
      var hostname = new URL(url).hostname;
      if (hostname.split('.').length > 4) {
        result.threats.push({ type: 'EXCESSIVE_SUBDOMAINS', severity: 'MEDIUM', message: 'Excessive subdomains may indicate phishing attempt' });
        result.score -= 15;
      }
    } catch(e) {}

    // URL encoding abuse
    if ((url.match(/%/g) || []).length > 3) {
      result.threats.push({ type: 'ENCODING_ABUSE', severity: 'MEDIUM', message: 'Excessive URL encoding may hide malicious content' });
      result.score -= 15;
    }

    // Phishing keywords
    var phishKeywords = ['login', 'signin', 'verify', 'account', 'update', 'secure', 'banking', 'confirm', 'password', 'credential'];
    var pathPart = '';
    try { pathPart = new URL(url).pathname.toLowerCase(); } catch(e) { pathPart = lowerUrl; }
    phishKeywords.forEach(function(kw) {
      if (pathPart.includes(kw)) {
        result.threats.push({ type: 'PHISH_KEYWORD', severity: 'LOW', message: 'URL path contains suspicious keyword: ' + kw });
        result.score -= 5;
      }
    });

    // Data URI
    if (lowerUrl.startsWith('data:')) {
      result.threats.push({ type: 'DATA_URI', severity: 'HIGH', message: 'Data URIs can hide malicious content' });
      result.score -= 35;
    }

    // javascript: URI
    if (lowerUrl.startsWith('javascript:')) {
      result.threats.push({ type: 'JAVASCRIPT_URI', severity: 'CRITICAL', message: 'JavaScript URI can execute arbitrary code' });
      result.score -= 50;
    }

    result.score = Math.max(0, result.score);
    result.safe = result.score >= 70;
    return result;
  },

  // File hash scanner
  hashFile: function(file) {
    return new Promise(function(resolve, reject) {
      var reader = new FileReader();
      reader.onload = function(e) {
        crypto.subtle.digest('SHA-256', e.target.result).then(function(hashBuffer) {
          var hashArray = Array.from(new Uint8Array(hashBuffer));
          var hashHex = hashArray.map(function(b) { return b.toString(16).padStart(2, '0'); }).join('');
          resolve({
            name: file.name,
            size: file.size,
            type: file.type || 'unknown',
            sha256: hashHex,
            lastModified: new Date(file.lastModified).toISOString()
          });
        }).catch(reject);
      };
      reader.onerror = reject;
      reader.readAsArrayBuffer(file);
    });
  },

  // Permission audit
  auditPermissions: function() {
    var permissions = [
      { name: 'geolocation', label: 'Location', risk: 'HIGH', description: 'Access to your physical location' },
      { name: 'notifications', label: 'Notifications', risk: 'LOW', description: 'Ability to send push notifications' },
      { name: 'camera', label: 'Camera', risk: 'HIGH', description: 'Access to camera hardware' },
      { name: 'microphone', label: 'Microphone', risk: 'HIGH', description: 'Access to microphone audio' },
      { name: 'clipboard-read', label: 'Clipboard Read', risk: 'MEDIUM', description: 'Read contents of clipboard' },
      { name: 'clipboard-write', label: 'Clipboard Write', risk: 'LOW', description: 'Write to clipboard' },
      { name: 'accelerometer', label: 'Accelerometer', risk: 'LOW', description: 'Motion sensor data' },
      { name: 'gyroscope', label: 'Gyroscope', risk: 'LOW', description: 'Orientation sensor data' },
      { name: 'magnetometer', label: 'Magnetometer', risk: 'LOW', description: 'Magnetic field sensor data' },
      { name: 'midi', label: 'MIDI Devices', risk: 'LOW', description: 'MIDI instrument access' },
      { name: 'persistent-storage', label: 'Persistent Storage', risk: 'LOW', description: 'Store data persistently' }
    ];

    return Promise.all(permissions.map(function(perm) {
      return navigator.permissions.query({ name: perm.name }).then(function(result) {
        return Object.assign({}, perm, { state: result.state });
      }).catch(function() {
        return Object.assign({}, perm, { state: 'unsupported' });
      });
    }));
  },

  // Wi-Fi analyzer (simulated since Web APIs are limited)
  analyzeWifi: function(ssid, securityType, signalStrength) {
    var result = { ssid: ssid, issues: [], score: 100, recommendations: [] };
    
    if (securityType === 'OPEN' || securityType === 'None') {
      result.issues.push({ severity: 'CRITICAL', message: 'Open network with no encryption - all traffic visible to attackers' });
      result.score -= 50;
      result.recommendations.push('Use a VPN when connected to open networks');
      result.recommendations.push('Avoid transmitting sensitive data on this network');
    }
    if (securityType === 'WEP') {
      result.issues.push({ severity: 'CRITICAL', message: 'WEP encryption is broken and can be cracked in minutes' });
      result.score -= 45;
      result.recommendations.push('Upgrade to WPA3 or at minimum WPA2');
    }
    if (securityType === 'WPA') {
      result.issues.push({ severity: 'HIGH', message: 'WPA (TKIP) has known vulnerabilities' });
      result.score -= 25;
      result.recommendations.push('Upgrade to WPA2 or WPA3');
    }
    if (securityType === 'WPA2') {
      result.issues.push({ severity: 'LOW', message: 'WPA2 is secure but WPA3 offers improved protection' });
      result.score -= 5;
      result.recommendations.push('Consider upgrading to WPA3 when possible');
    }

    // Hidden SSID check
    if (!ssid || ssid.trim() === '') {
      result.issues.push({ severity: 'MEDIUM', message: 'Hidden SSID provides no real security benefit and can cause probe requests' });
      result.score -= 10;
    }

    // Common SSID names
    var commonNames = ['linksys', 'netgear', 'default', 'admin', 'password', 'wifi', 'home'];
    if (commonNames.some(function(n) { return ssid.toLowerCase().includes(n); })) {
      result.issues.push({ severity: 'LOW', message: 'Common/default SSID name may indicate unconfigured router' });
      result.score -= 5;
    }

    // Signal strength
    if (signalStrength < 30) {
      result.issues.push({ severity: 'MEDIUM', message: 'Weak signal strength (' + signalStrength + '%) may cause connection instability' });
      result.score -= 10;
    }

    result.score = Math.max(0, result.score);
    return result;
  },

  // OSINT / Breach check (simulated)
  checkBreach: function(email) {
    // Simulated breach database for demonstration
    var knownBreaches = {
      'test@example.com': [
        { name: 'ExampleCorp', date: '2023-06-15', records: 2300000, dataTypes: ['email', 'password', 'name'] },
        { name: 'SocialApp', date: '2022-01-10', records: 15000000, dataTypes: ['email', 'username', 'ip_address'] }
      ]
    };

    return new Promise(function(resolve) {
      setTimeout(function() {
        var breaches = knownBreaches[email.toLowerCase()] || [];
        var isDemo = breaches.length === 0;
        
        // Generate realistic demo data for any email
        if (isDemo && email.includes('@')) {
          var domain = email.split('@')[1];
          var hash = 0;
          for (var i = 0; i < email.length; i++) {
            hash = ((hash << 5) - hash) + email.charCodeAt(i);
            hash |= 0;
          }
          var numBreaches = Math.abs(hash) % 4;
          var demoBreaches = [
            { name: 'DataDump 2023', date: '2023-08-22', records: 4100000, dataTypes: ['email', 'hashed_password'] },
            { name: 'SocialPlatform Leak', date: '2022-11-03', records: 87000000, dataTypes: ['email', 'username', 'phone'] },
            { name: 'RetailStore Breach', date: '2024-02-14', records: 920000, dataTypes: ['email', 'name', 'address', 'partial_cc'] },
            { name: 'ForumHack', date: '2021-07-09', records: 3200000, dataTypes: ['email', 'password', 'ip_address', 'username'] }
          ];
          breaches = demoBreaches.slice(0, numBreaches);
        }

        resolve({
          email: email,
          breachCount: breaches.length,
          breaches: breaches,
          recommendation: breaches.length > 0 ? 'Change passwords for affected accounts and enable 2FA' : 'No known breaches found. Continue monitoring.'
        });
      }, 1500);
    });
  },

  // Security score calculator
  calculateSecurityScore: function(data) {
    var score = 100;
    var factors = [];

    // HTTPS check
    if (window.location.protocol === 'https:') {
      factors.push({ name: 'HTTPS Connection', status: 'pass', impact: 0 });
    } else {
      factors.push({ name: 'HTTPS Connection', status: 'fail', impact: -15 });
      score -= 15;
    }

    // Modern browser
    if (window.crypto && window.crypto.subtle) {
      factors.push({ name: 'Web Crypto API', status: 'pass', impact: 0 });
    } else {
      factors.push({ name: 'Web Crypto API', status: 'fail', impact: -10 });
      score -= 10;
    }

    // Service Worker support
    if ('serviceWorker' in navigator) {
      factors.push({ name: 'Service Worker Support', status: 'pass', impact: 0 });
    } else {
      factors.push({ name: 'Service Worker Support', status: 'warn', impact: -5 });
      score -= 5;
    }

    // Secure context
    if (window.isSecureContext) {
      factors.push({ name: 'Secure Context', status: 'pass', impact: 0 });
    } else {
      factors.push({ name: 'Secure Context', status: 'fail', impact: -20 });
      score -= 20;
    }

    // Cookie settings
    if (navigator.cookieEnabled) {
      factors.push({ name: 'Cookies Enabled', status: 'warn', impact: -3 });
      score -= 3;
    } else {
      factors.push({ name: 'Cookies Disabled', status: 'pass', impact: 0 });
    }

    // DNT
    if (navigator.doNotTrack === '1') {
      factors.push({ name: 'Do Not Track', status: 'pass', impact: 0 });
    } else {
      factors.push({ name: 'Do Not Track', status: 'warn', impact: -5 });
      score -= 5;
    }

    return { score: Math.max(0, Math.min(100, score)), factors: factors };
  }
};


// ============================================================
// REUSABLE UI COMPONENTS
// ============================================================

function ScoreRing(props) {
  var score = props.score || 0;
  var size = props.size || 120;
  var strokeWidth = props.strokeWidth || 8;
  var radius = (size - strokeWidth) / 2;
  var circumference = radius * 2 * Math.PI;
  var offset = circumference - (score / 100) * circumference;
  var color = score >= 80 ? '#22c55e' : score >= 60 ? '#eab308' : score >= 40 ? '#f97316' : '#ef4444';

  return h('div', { className: 'relative inline-flex items-center justify-center' },
    h('svg', { width: size, height: size, className: 'transform -rotate-90' },
      h('circle', { cx: size / 2, cy: size / 2, r: radius, stroke: '#262626', strokeWidth: strokeWidth, fill: 'transparent' }),
      h('circle', {
        cx: size / 2, cy: size / 2, r: radius,
        stroke: color, strokeWidth: strokeWidth, fill: 'transparent',
        strokeDasharray: circumference, strokeDashoffset: offset,
        strokeLinecap: 'round',
        style: { transition: 'stroke-dashoffset 1s ease-in-out' }
      })
    ),
    h('div', { className: 'absolute inset-0 flex flex-col items-center justify-center' },
      h('span', { className: 'text-2xl font-bold', style: { color: color } }, score),
      props.label ? h('span', { className: 'text-xs text-neutral-400 mt-0.5' }, props.label) : null
    )
  );
}

function SeverityBadge(props) {
  var severity = props.severity || 'LOW';
  var colorMap = {
    CRITICAL: 'bg-red-500/20 text-red-400 border-red-500/30',
    HIGH: 'bg-orange-500/20 text-orange-400 border-orange-500/30',
    MEDIUM: 'bg-yellow-500/20 text-yellow-400 border-yellow-500/30',
    LOW: 'bg-green-500/20 text-green-400 border-green-500/30'
  };
  var classes = colorMap[severity] || colorMap.LOW;
  return h('span', { className: 'px-2 py-0.5 text-xs font-semibold rounded-full border ' + classes }, severity);
}

function StatCard(props) {
  return h('div', { className: 'bg-neutral-900 border border-neutral-800 rounded-xl p-4 hover:border-neutral-700 transition-colors' },
    h('div', { className: 'flex items-center justify-between mb-2' },
      h('span', { className: 'text-neutral-400 text-sm' }, props.label),
      props.icon ? h('div', { className: 'text-green-500' }, props.icon) : null
    ),
    h('div', { className: 'text-2xl font-bold text-white' }, props.value),
    props.subtitle ? h('div', { className: 'text-xs text-neutral-500 mt-1' }, props.subtitle) : null
  );
}


// ============================================================
// PAGE: DASHBOARD
// ============================================================

function DashboardPage() {
  var secResult = useState(null);
  var securityData = secResult[0];
  var setSecurityData = secResult[1];

  useEffect(function() {
    var data = SecurityServices.calculateSecurityScore();
    setSecurityData(data);
  }, []);

  var criticalCves = CVE_DATABASE.filter(function(c) { return c.severity === 'CRITICAL'; }).length;
  var exploitedCves = CVE_DATABASE.filter(function(c) { return c.exploitedInWild; }).length;
  var recentCves = CVE_DATABASE.filter(function(c) { return c.published >= '2024-06-01'; }).length;

  return h('div', { className: 'space-y-6 animate-fade-in' },
    // Header
    h('div', { className: 'flex items-center justify-between' },
      h('div', null,
        h('h1', { className: 'text-2xl font-bold text-white' }, 'Security Dashboard'),
        h('p', { className: 'text-neutral-400 text-sm mt-1' }, 'Real-time security posture overview')
      ),
      h('div', { className: 'flex items-center gap-2 text-xs text-neutral-500' },
        h(IconClock, { size: 14 }),
        'Last updated: ' + new Date().toLocaleTimeString()
      )
    ),

    // Score + Stats row
    h('div', { className: 'grid grid-cols-1 md:grid-cols-4 gap-4' },
      h('div', { className: 'bg-neutral-900 border border-neutral-800 rounded-xl p-6 flex flex-col items-center justify-center md:col-span-1' },
        h(ScoreRing, { score: securityData ? securityData.score : 0, size: 140, label: 'Security' }),
        h('p', { className: 'text-sm text-neutral-400 mt-3' }, 'Overall Security Score')
      ),
      h('div', { className: 'md:col-span-3 grid grid-cols-1 sm:grid-cols-3 gap-4' },
        h(StatCard, { label: 'Known CVEs Tracked', value: CVE_DATABASE.length, icon: h(IconBug, { size: 18 }), subtitle: criticalCves + ' critical severity' }),
        h(StatCard, { label: 'Exploited in Wild', value: exploitedCves, icon: h(IconAlertTriangle, { size: 18 }), subtitle: 'Active threat' }),
        h(StatCard, { label: 'Devices in Database', value: DEVICE_DATABASE.length, icon: h(IconSmartphone, { size: 18 }), subtitle: 'Compare security postures' }),
        h(StatCard, { label: 'Recent CVEs (6mo)', value: recentCves, icon: h(IconTrendingUp, { size: 18 }), subtitle: 'Since mid-2024' }),
        h(StatCard, { label: 'Scanner Tools', value: '7', icon: h(IconScan, { size: 18 }), subtitle: 'All operational' }),
        h(StatCard, { label: 'AI Assistant', value: 'Online', icon: h(IconSparkles, { size: 18 }), subtitle: 'Ready to help' })
      )
    ),

    // Security factors
    securityData ? h('div', { className: 'bg-neutral-900 border border-neutral-800 rounded-xl p-6' },
      h('h2', { className: 'text-lg font-semibold text-white mb-4' }, 'Browser Security Factors'),
      h('div', { className: 'space-y-3' },
        securityData.factors.map(function(factor, i) {
          var statusColor = factor.status === 'pass' ? 'text-green-400' : factor.status === 'fail' ? 'text-red-400' : 'text-yellow-400';
          var statusIcon = factor.status === 'pass' ? h(IconCheckCircle, { size: 16 }) : factor.status === 'fail' ? h(IconXCircle, { size: 16 }) : h(IconAlertTriangle, { size: 16 });
          return h('div', { key: i, className: 'flex items-center justify-between py-2 border-b border-neutral-800 last:border-0' },
            h('div', { className: 'flex items-center gap-3' },
              h('span', { className: statusColor }, statusIcon),
              h('span', { className: 'text-sm text-neutral-300' }, factor.name)
            ),
            h('span', { className: 'text-xs ' + (factor.impact === 0 ? 'text-green-400' : 'text-red-400') },
              factor.impact === 0 ? 'No impact' : factor.impact + ' points'
            )
          );
        })
      )
    ) : null,

    // Recent CVEs
    h('div', { className: 'bg-neutral-900 border border-neutral-800 rounded-xl p-6' },
      h('h2', { className: 'text-lg font-semibold text-white mb-4' }, 'Latest Vulnerability Alerts'),
      h('div', { className: 'space-y-3' },
        CVE_DATABASE.slice(0, 5).map(function(cve) {
          return h('div', { key: cve.id, className: 'flex items-start justify-between py-3 border-b border-neutral-800 last:border-0' },
            h('div', { className: 'flex-1 min-w-0 mr-4' },
              h('div', { className: 'flex items-center gap-2 mb-1' },
                h('span', { className: 'text-sm font-mono text-green-400' }, cve.id),
                h(SeverityBadge, { severity: cve.severity }),
                cve.exploitedInWild ? h('span', { className: 'px-2 py-0.5 text-xs bg-red-500/10 text-red-400 rounded-full border border-red-500/20' }, 'Exploited') : null
              ),
              h('p', { className: 'text-sm text-neutral-300 line-clamp-2' }, cve.title)
            ),
            h('span', { className: 'text-xs text-neutral-500 whitespace-nowrap' }, cve.published)
          );
        })
      )
    )
  );
}


// ============================================================
// PAGE: VULNERABILITY SCANNER
// ============================================================

function VulnerabilityScannerPage() {
  var searchResult = useState('');
  var searchTerm = searchResult[0];
  var setSearchTerm = searchResult[1];

  var filterResult = useState('ALL');
  var severityFilter = filterResult[0];
  var setSeverityFilter = filterResult[1];

  var exploitResult = useState(false);
  var showExploitedOnly = exploitResult[0];
  var setShowExploitedOnly = exploitResult[1];

  var expandedResult = useState(null);
  var expandedCve = expandedResult[0];
  var setExpandedCve = expandedResult[1];

  var filtered = CVE_DATABASE.filter(function(cve) {
    var matchSearch = !searchTerm || cve.id.toLowerCase().includes(searchTerm.toLowerCase()) || cve.title.toLowerCase().includes(searchTerm.toLowerCase()) || cve.description.toLowerCase().includes(searchTerm.toLowerCase());
    var matchSeverity = severityFilter === 'ALL' || cve.severity === severityFilter;
    var matchExploited = !showExploitedOnly || cve.exploitedInWild;
    return matchSearch && matchSeverity && matchExploited;
  });

  return h('div', { className: 'space-y-6 animate-fade-in' },
    h('div', null,
      h('h1', { className: 'text-2xl font-bold text-white' }, 'Vulnerability Scanner'),
      h('p', { className: 'text-neutral-400 text-sm mt-1' }, 'Browse and search known Android CVEs')
    ),

    // Filters
    h('div', { className: 'flex flex-wrap items-center gap-3' },
      h('div', { className: 'relative flex-1 min-w-[200px]' },
        h('div', { className: 'absolute left-3 top-1/2 -translate-y-1/2 text-neutral-500' }, h(IconSearch, { size: 16 })),
        h('input', {
          type: 'text', placeholder: 'Search CVEs by ID, title, or description...',
          className: 'w-full bg-neutral-900 border border-neutral-800 rounded-lg pl-10 pr-4 py-2.5 text-sm text-white placeholder:text-neutral-500 focus:outline-none focus:border-green-500/50',
          value: searchTerm,
          onChange: function(e) { setSearchTerm(e.target.value); }
        })
      ),
      h('select', {
        className: 'bg-neutral-900 border border-neutral-800 rounded-lg px-3 py-2.5 text-sm text-white focus:outline-none focus:border-green-500/50',
        value: severityFilter,
        onChange: function(e) { setSeverityFilter(e.target.value); }
      },
        h('option', { value: 'ALL' }, 'All Severities'),
        h('option', { value: 'CRITICAL' }, 'Critical'),
        h('option', { value: 'HIGH' }, 'High'),
        h('option', { value: 'MEDIUM' }, 'Medium'),
        h('option', { value: 'LOW' }, 'Low')
      ),
      h('button', {
        className: 'px-4 py-2.5 rounded-lg text-sm font-medium border transition-colors ' + (showExploitedOnly ? 'bg-red-500/20 border-red-500/30 text-red-400' : 'bg-neutral-900 border-neutral-800 text-neutral-400 hover:border-neutral-700'),
        onClick: function() { setShowExploitedOnly(!showExploitedOnly); }
      }, 'Exploited in Wild')
    ),

    // Results count
    h('div', { className: 'text-sm text-neutral-500' }, 'Showing ' + filtered.length + ' of ' + CVE_DATABASE.length + ' vulnerabilities'),

    // CVE List
    h('div', { className: 'space-y-3' },
      filtered.map(function(cve) {
        var isExpanded = expandedCve === cve.id;
        return h('div', { key: cve.id, className: 'bg-neutral-900 border border-neutral-800 rounded-xl overflow-hidden hover:border-neutral-700 transition-colors' },
          h('div', {
            className: 'p-4 cursor-pointer',
            onClick: function() { setExpandedCve(isExpanded ? null : cve.id); }
          },
            h('div', { className: 'flex items-start justify-between' },
              h('div', { className: 'flex-1 min-w-0' },
                h('div', { className: 'flex items-center gap-2 mb-1 flex-wrap' },
                  h('span', { className: 'font-mono text-sm text-green-400 font-semibold' }, cve.id),
                  h(SeverityBadge, { severity: cve.severity }),
                  cve.exploitedInWild ? h('span', { className: 'px-2 py-0.5 text-xs bg-red-500/10 text-red-400 rounded-full border border-red-500/20 flex items-center gap-1' }, h(IconAlertTriangle, { size: 10 }), 'Exploited') : null,
                  h('span', { className: 'px-2 py-0.5 text-xs bg-neutral-800 text-neutral-400 rounded-full' }, cve.category)
                ),
                h('h3', { className: 'text-white font-medium text-sm mt-1' }, cve.title),
                h('p', { className: 'text-neutral-400 text-xs mt-1 line-clamp-2' }, cve.description)
              ),
              h('div', { className: 'text-right ml-4 flex-shrink-0' },
                h('div', { className: 'text-lg font-bold ' + (cve.cvss >= 9 ? 'text-red-400' : cve.cvss >= 7 ? 'text-orange-400' : cve.cvss >= 4 ? 'text-yellow-400' : 'text-green-400') }, cve.cvss),
                h('div', { className: 'text-xs text-neutral-500' }, 'CVSS')
              )
            )
          ),
          isExpanded ? h('div', { className: 'px-4 pb-4 border-t border-neutral-800 pt-4 animate-fade-in' },
            h('div', { className: 'grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4 text-sm' },
              h('div', null,
                h('span', { className: 'text-neutral-500 text-xs block mb-1' }, 'Affected'),
                h('span', { className: 'text-neutral-300' }, cve.affected)
              ),
              h('div', null,
                h('span', { className: 'text-neutral-500 text-xs block mb-1' }, 'Attack Vector'),
                h('span', { className: 'text-neutral-300' }, cve.vector)
              ),
              h('div', null,
                h('span', { className: 'text-neutral-500 text-xs block mb-1' }, 'Published'),
                h('span', { className: 'text-neutral-300' }, cve.published)
              ),
              h('div', null,
                h('span', { className: 'text-neutral-500 text-xs block mb-1' }, 'Patch Available'),
                h('span', { className: 'text-green-400' }, cve.patched)
              )
            ),
            h('div', { className: 'mt-3 p-3 bg-neutral-950 rounded-lg' },
              h('p', { className: 'text-sm text-neutral-300 leading-relaxed' }, cve.description)
            ),
            h('a', {
              href: 'https://nvd.nist.gov/vuln/detail/' + cve.id,
              target: '_blank', rel: 'noopener noreferrer',
              className: 'inline-flex items-center gap-1 mt-3 text-sm text-green-400 hover:text-green-300 transition-colors'
            }, 'View on NVD ', h(IconExternalLink, { size: 14 }))
          ) : null
        );
      })
    ),

    filtered.length === 0 ? h('div', { className: 'text-center py-12 text-neutral-500' },
      h(IconSearch, { size: 48, className: 'mx-auto mb-3 opacity-30' }),
      h('p', null, 'No vulnerabilities match your search criteria')
    ) : null
  );
}


// ============================================================
// PAGE: URL SCANNER
// ============================================================

function UrlScannerPage() {
  var urlResult = useState('');
  var url = urlResult[0];
  var setUrl = urlResult[1];

  var resultsResult = useState(null);
  var results = resultsResult[0];
  var setResults = resultsResult[1];

  var histResult = useState([]);
  var history = histResult[0];
  var setHistory = histResult[1];

  var loadResult = useState(false);
  var loading = loadResult[0];
  var setLoading = loadResult[1];

  function handleScan() {
    if (!url.trim()) return;
    setLoading(true);
    setTimeout(function() {
      var scanResult = SecurityServices.scanUrl(url);
      setResults(scanResult);
      setHistory(function(prev) { return [scanResult].concat(prev).slice(0, 10); });
      setLoading(false);
    }, 800);
  }

  return h('div', { className: 'space-y-6 animate-fade-in' },
    h('div', null,
      h('h1', { className: 'text-2xl font-bold text-white' }, 'URL Scanner'),
      h('p', { className: 'text-neutral-400 text-sm mt-1' }, 'Analyze URLs for phishing, malware, and suspicious patterns')
    ),

    // Input
    h('div', { className: 'bg-neutral-900 border border-neutral-800 rounded-xl p-6' },
      h('div', { className: 'flex gap-3' },
        h('div', { className: 'relative flex-1' },
          h('div', { className: 'absolute left-3 top-1/2 -translate-y-1/2 text-neutral-500' }, h(IconGlobe, { size: 16 })),
          h('input', {
            type: 'text', placeholder: 'Enter URL to scan (e.g., https://example.com)',
            className: 'w-full bg-neutral-950 border border-neutral-800 rounded-lg pl-10 pr-4 py-3 text-sm text-white placeholder:text-neutral-500 focus:outline-none focus:border-green-500/50',
            value: url,
            onChange: function(e) { setUrl(e.target.value); },
            onKeyDown: function(e) { if (e.key === 'Enter') handleScan(); }
          })
        ),
        h('button', {
          className: 'px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium text-sm transition-colors flex items-center gap-2 disabled:opacity-50',
          onClick: handleScan,
          disabled: loading || !url.trim()
        }, loading ? h('span', { className: 'animate-scan-pulse' }, 'Scanning...') : h(React.Fragment, null, h(IconScan, { size: 16 }), 'Scan'))
      ),

      // Quick test URLs
      h('div', { className: 'flex flex-wrap gap-2 mt-3' },
        h('span', { className: 'text-xs text-neutral-500' }, 'Try:'),
        ['https://google.com', 'http://g00gle.tk/login', 'https://192.168.1.1/admin', 'http://free-iphone.xyz/claim'].map(function(testUrl) {
          return h('button', {
            key: testUrl,
            className: 'text-xs text-green-400/70 hover:text-green-400 transition-colors',
            onClick: function() { setUrl(testUrl); }
          }, testUrl);
        })
      )
    ),

    // Results
    results ? h('div', { className: 'bg-neutral-900 border border-neutral-800 rounded-xl p-6 animate-slide-up' },
      h('div', { className: 'flex items-center justify-between mb-4' },
        h('h2', { className: 'text-lg font-semibold text-white' }, 'Scan Results'),
        h('div', { className: 'flex items-center gap-2' },
          results.safe ? h(IconCheckCircle, { size: 20, className: 'text-green-400' }) : h(IconXCircle, { size: 20, className: 'text-red-400' }),
          h('span', { className: results.safe ? 'text-green-400 font-medium' : 'text-red-400 font-medium' }, results.safe ? 'URL appears safe' : 'Threats detected!')
        )
      ),

      h('div', { className: 'flex items-center gap-4 mb-6' },
        h(ScoreRing, { score: results.score, size: 80, strokeWidth: 6, label: 'Safety' }),
        h('div', null,
          h('p', { className: 'text-sm text-neutral-300 font-mono break-all' }, results.url),
          h('p', { className: 'text-xs text-neutral-500 mt-1' }, results.threats.length + ' issue(s) detected')
        )
      ),

      results.threats.length > 0 ? h('div', { className: 'space-y-2' },
        h('h3', { className: 'text-sm font-medium text-neutral-300 mb-2' }, 'Threats Found'),
        results.threats.map(function(threat, i) {
          return h('div', { key: i, className: 'flex items-start gap-3 p-3 bg-neutral-950 rounded-lg border border-neutral-800' },
            h(SeverityBadge, { severity: threat.severity }),
            h('div', null,
              h('span', { className: 'text-xs font-mono text-neutral-500' }, threat.type),
              h('p', { className: 'text-sm text-neutral-300 mt-0.5' }, threat.message)
            )
          );
        })
      ) : h('div', { className: 'text-center py-6' },
        h(IconCheckCircle, { size: 48, className: 'mx-auto text-green-400/30 mb-2' }),
        h('p', { className: 'text-neutral-400 text-sm' }, 'No threats detected in this URL')
      )
    ) : null,

    // History
    history.length > 0 ? h('div', { className: 'bg-neutral-900 border border-neutral-800 rounded-xl p-6' },
      h('div', { className: 'flex items-center justify-between mb-4' },
        h('h2', { className: 'text-lg font-semibold text-white' }, 'Scan History'),
        h('button', {
          className: 'text-xs text-neutral-500 hover:text-red-400 transition-colors flex items-center gap-1',
          onClick: function() { setHistory([]); }
        }, h(IconTrash, { size: 12 }), 'Clear')
      ),
      h('div', { className: 'space-y-2' },
        history.map(function(item, i) {
          return h('div', { key: i, className: 'flex items-center justify-between py-2 border-b border-neutral-800 last:border-0' },
            h('div', { className: 'flex items-center gap-2 flex-1 min-w-0' },
              item.safe ? h(IconCheckCircle, { size: 14, className: 'text-green-400 flex-shrink-0' }) : h(IconXCircle, { size: 14, className: 'text-red-400 flex-shrink-0' }),
              h('span', { className: 'text-sm text-neutral-300 truncate' }, item.url)
            ),
            h('span', { className: 'text-xs font-medium ml-2 ' + (item.score >= 70 ? 'text-green-400' : item.score >= 40 ? 'text-yellow-400' : 'text-red-400') }, item.score + '/100')
          );
        })
      )
    ) : null
  );
}


// ============================================================
// PAGE: PERMISSION AUDIT
// ============================================================

function PermissionAuditPage() {
  var permResult = useState([]);
  var permissions = permResult[0];
  var setPermissions = permResult[1];

  var loadResult = useState(false);
  var loading = loadResult[0];
  var setLoading = loadResult[1];

  var auditedResult = useState(false);
  var audited = auditedResult[0];
  var setAudited = auditedResult[1];

  function runAudit() {
    setLoading(true);
    SecurityServices.auditPermissions().then(function(results) {
      setPermissions(results);
      setLoading(false);
      setAudited(true);
    });
  }

  var granted = permissions.filter(function(p) { return p.state === 'granted'; });
  var denied = permissions.filter(function(p) { return p.state === 'denied'; });
  var prompted = permissions.filter(function(p) { return p.state === 'prompt'; });
  var unsupported = permissions.filter(function(p) { return p.state === 'unsupported'; });

  function stateColor(state) {
    if (state === 'granted') return 'text-yellow-400';
    if (state === 'denied') return 'text-green-400';
    if (state === 'prompt') return 'text-blue-400';
    return 'text-neutral-500';
  }

  function stateIcon(state) {
    if (state === 'granted') return h(IconAlertTriangle, { size: 16 });
    if (state === 'denied') return h(IconCheckCircle, { size: 16 });
    if (state === 'prompt') return h(IconClock, { size: 16 });
    return h(IconXCircle, { size: 16 });
  }

  return h('div', { className: 'space-y-6 animate-fade-in' },
    h('div', null,
      h('h1', { className: 'text-2xl font-bold text-white' }, 'Permission Audit'),
      h('p', { className: 'text-neutral-400 text-sm mt-1' }, 'Analyze browser permissions granted to this site')
    ),

    !audited ? h('div', { className: 'bg-neutral-900 border border-neutral-800 rounded-xl p-12 text-center' },
      h(IconLock, { size: 48, className: 'mx-auto text-green-400/30 mb-4' }),
      h('h2', { className: 'text-lg font-semibold text-white mb-2' }, 'Ready to Audit Permissions'),
      h('p', { className: 'text-neutral-400 text-sm mb-6 max-w-md mx-auto' }, 'This will check which browser permissions are currently granted, denied, or awaiting prompt for this origin.'),
      h('button', {
        className: 'px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium text-sm transition-colors inline-flex items-center gap-2',
        onClick: runAudit,
        disabled: loading
      }, loading ? 'Auditing...' : h(React.Fragment, null, h(IconScan, { size: 16 }), 'Run Audit'))
    ) : h(React.Fragment, null,
      // Summary cards
      h('div', { className: 'grid grid-cols-2 md:grid-cols-4 gap-4' },
        h(StatCard, { label: 'Granted', value: granted.length, icon: h(IconAlertTriangle, { size: 18, className: 'text-yellow-400' }), subtitle: 'Active permissions' }),
        h(StatCard, { label: 'Denied', value: denied.length, icon: h(IconCheckCircle, { size: 18, className: 'text-green-400' }), subtitle: 'Blocked access' }),
        h(StatCard, { label: 'Prompt', value: prompted.length, icon: h(IconClock, { size: 18, className: 'text-blue-400' }), subtitle: 'Will ask on use' }),
        h(StatCard, { label: 'Unsupported', value: unsupported.length, icon: h(IconXCircle, { size: 18, className: 'text-neutral-500' }), subtitle: 'Not available' })
      ),

      // Permission list
      h('div', { className: 'bg-neutral-900 border border-neutral-800 rounded-xl p-6' },
        h('div', { className: 'flex items-center justify-between mb-4' },
          h('h2', { className: 'text-lg font-semibold text-white' }, 'Permission Details'),
          h('button', {
            className: 'text-xs text-green-400 hover:text-green-300 transition-colors flex items-center gap-1',
            onClick: runAudit
          }, h(IconScan, { size: 12 }), 'Re-audit')
        ),
        h('div', { className: 'space-y-2' },
          permissions.map(function(perm, i) {
            return h('div', { key: i, className: 'flex items-center justify-between p-3 bg-neutral-950 rounded-lg border border-neutral-800' },
              h('div', { className: 'flex items-center gap-3' },
                h('span', { className: stateColor(perm.state) }, stateIcon(perm.state)),
                h('div', null,
                  h('span', { className: 'text-sm text-white font-medium' }, perm.label),
                  h('p', { className: 'text-xs text-neutral-500' }, perm.description)
                )
              ),
              h('div', { className: 'flex items-center gap-2' },
                h(SeverityBadge, { severity: perm.risk }),
                h('span', { className: 'text-xs capitalize px-2 py-0.5 rounded-full ' + (perm.state === 'granted' ? 'bg-yellow-500/10 text-yellow-400' : perm.state === 'denied' ? 'bg-green-500/10 text-green-400' : perm.state === 'prompt' ? 'bg-blue-500/10 text-blue-400' : 'bg-neutral-800 text-neutral-500') }, perm.state)
              )
            );
          })
        )
      ),

      // Recommendations
      granted.length > 0 ? h('div', { className: 'bg-yellow-500/5 border border-yellow-500/20 rounded-xl p-6' },
        h('div', { className: 'flex items-start gap-3' },
          h(IconAlertTriangle, { size: 20, className: 'text-yellow-400 mt-0.5 flex-shrink-0' }),
          h('div', null,
            h('h3', { className: 'text-sm font-medium text-yellow-400 mb-1' }, 'Recommendations'),
            h('ul', { className: 'text-sm text-neutral-400 space-y-1 list-disc list-inside' },
              h('li', null, 'Review granted permissions and revoke any that are unnecessary'),
              h('li', null, 'High-risk permissions (Camera, Microphone, Location) should only be granted to trusted sites'),
              h('li', null, 'You can manage permissions in your browser settings')
            )
          )
        )
      ) : null
    )
  );
}


// ============================================================
// PAGE: FILE SCANNER
// ============================================================

function FileScannerPage() {
  var filesResult = useState([]);
  var scannedFiles = filesResult[0];
  var setScannedFiles = filesResult[1];

  var loadResult = useState(false);
  var scanning = loadResult[0];
  var setScanning = loadResult[1];

  var fileInputRef = useRef(null);

  function handleFileSelect(e) {
    var files = Array.from(e.target.files || []);
    if (files.length === 0) return;
    setScanning(true);

    Promise.all(files.map(function(file) {
      return SecurityServices.hashFile(file);
    })).then(function(results) {
      setScannedFiles(function(prev) { return results.concat(prev); });
      setScanning(false);
    }).catch(function() {
      setScanning(false);
    });
  }

  function formatFileSize(bytes) {
    if (bytes === 0) return '0 B';
    var k = 1024;
    var sizes = ['B', 'KB', 'MB', 'GB'];
    var i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
  }

  // Suspicious file extensions
  function checkExtension(filename) {
    var dangerous = ['.exe', '.bat', '.cmd', '.scr', '.pif', '.msi', '.jar', '.vbs', '.ps1', '.apk', '.deb', '.sh'];
    var warning = ['.zip', '.rar', '.7z', '.tar', '.gz', '.iso', '.dmg', '.doc', '.docm', '.xlsm'];
    var lower = filename.toLowerCase();
    if (dangerous.some(function(ext) { return lower.endsWith(ext); })) return 'CRITICAL';
    if (warning.some(function(ext) { return lower.endsWith(ext); })) return 'MEDIUM';
    return 'LOW';
  }

  return h('div', { className: 'space-y-6 animate-fade-in' },
    h('div', null,
      h('h1', { className: 'text-2xl font-bold text-white' }, 'File Scanner'),
      h('p', { className: 'text-neutral-400 text-sm mt-1' }, 'Calculate SHA-256 hashes and analyze file metadata')
    ),

    // Upload area
    h('div', {
      className: 'bg-neutral-900 border-2 border-dashed border-neutral-700 rounded-xl p-12 text-center cursor-pointer hover:border-green-500/50 transition-colors',
      onClick: function() { fileInputRef.current && fileInputRef.current.click(); }
    },
      h('input', {
        ref: fileInputRef, type: 'file', multiple: true,
        className: 'hidden',
        onChange: handleFileSelect
      }),
      scanning
        ? h(React.Fragment, null,
            h(IconScan, { size: 48, className: 'mx-auto text-green-400 mb-4 animate-scan-pulse' }),
            h('p', { className: 'text-white font-medium' }, 'Scanning files...'),
            h('p', { className: 'text-neutral-400 text-sm mt-1' }, 'Computing SHA-256 hashes')
          )
        : h(React.Fragment, null,
            h(IconUpload, { size: 48, className: 'mx-auto text-neutral-500 mb-4' }),
            h('p', { className: 'text-white font-medium' }, 'Drop files here or click to browse'),
            h('p', { className: 'text-neutral-400 text-sm mt-1' }, 'Files are processed locally - nothing is uploaded to any server')
          )
    ),

    // Results
    scannedFiles.length > 0 ? h(React.Fragment, null,
      h('div', { className: 'flex items-center justify-between' },
        h('h2', { className: 'text-lg font-semibold text-white' }, 'Scanned Files (' + scannedFiles.length + ')'),
        h('button', {
          className: 'text-xs text-neutral-500 hover:text-red-400 transition-colors flex items-center gap-1',
          onClick: function() { setScannedFiles([]); }
        }, h(IconTrash, { size: 12 }), 'Clear all')
      ),
      h('div', { className: 'space-y-3' },
        scannedFiles.map(function(file, i) {
          var risk = checkExtension(file.name);
          return h('div', { key: i, className: 'bg-neutral-900 border border-neutral-800 rounded-xl p-4' },
            h('div', { className: 'flex items-start justify-between mb-3' },
              h('div', { className: 'flex items-center gap-3' },
                h(IconFile, { size: 20, className: 'text-green-400 flex-shrink-0' }),
                h('div', null,
                  h('h3', { className: 'text-sm font-medium text-white' }, file.name),
                  h('p', { className: 'text-xs text-neutral-500' }, formatFileSize(file.size) + ' | ' + (file.type || 'Unknown type'))
                )
              ),
              h(SeverityBadge, { severity: risk })
            ),
            h('div', { className: 'bg-neutral-950 rounded-lg p-3 space-y-2' },
              h('div', { className: 'flex items-start gap-2' },
                h(IconHash, { size: 14, className: 'text-neutral-500 mt-0.5 flex-shrink-0' }),
                h('div', { className: 'min-w-0' },
                  h('span', { className: 'text-xs text-neutral-500 block' }, 'SHA-256'),
                  h('span', { className: 'text-xs font-mono text-green-400 break-all' }, file.sha256)
                )
              ),
              h('div', { className: 'flex items-center gap-2' },
                h(IconClock, { size: 14, className: 'text-neutral-500 flex-shrink-0' }),
                h('div', null,
                  h('span', { className: 'text-xs text-neutral-500 block' }, 'Last Modified'),
                  h('span', { className: 'text-xs text-neutral-300' }, new Date(file.lastModified).toLocaleString())
                )
              )
            ),
            risk === 'CRITICAL' ? h('div', { className: 'mt-3 p-2 bg-red-500/10 border border-red-500/20 rounded-lg flex items-center gap-2' },
              h(IconAlertTriangle, { size: 14, className: 'text-red-400' }),
              h('span', { className: 'text-xs text-red-400' }, 'This file type is commonly associated with malware. Exercise extreme caution.')
            ) : null
          );
        })
      )
    ) : null
  );
}


// ============================================================
// PAGE: DEVICE COMPARISON
// ============================================================

function DeviceComparisonPage() {
  var searchResult = useState('');
  var search = searchResult[0];
  var setSearch = searchResult[1];

  var brandResult = useState('ALL');
  var brandFilter = brandResult[0];
  var setBrandFilter = brandResult[1];

  var sortResult = useState('score');
  var sortBy = sortResult[0];
  var setSortBy = sortResult[1];

  var compareResult = useState([]);
  var compareList = compareResult[0];
  var setCompareList = compareResult[1];

  var brands = ['ALL'].concat(Array.from(new Set(DEVICE_DATABASE.map(function(d) { return d.brand; }))));

  var filtered = DEVICE_DATABASE.filter(function(d) {
    var matchSearch = !search || d.name.toLowerCase().includes(search.toLowerCase());
    var matchBrand = brandFilter === 'ALL' || d.brand === brandFilter;
    return matchSearch && matchBrand;
  }).sort(function(a, b) {
    if (sortBy === 'score') return b.securityScore - a.securityScore;
    if (sortBy === 'name') return a.name.localeCompare(b.name);
    if (sortBy === 'patch') return b.securityPatch.localeCompare(a.securityPatch);
    return 0;
  });

  function toggleCompare(device) {
    setCompareList(function(prev) {
      if (prev.find(function(d) { return d.name === device.name; })) {
        return prev.filter(function(d) { return d.name !== device.name; });
      }
      if (prev.length >= 3) return prev;
      return prev.concat([device]);
    });
  }

  return h('div', { className: 'space-y-6 animate-fade-in' },
    h('div', null,
      h('h1', { className: 'text-2xl font-bold text-white' }, 'Device Comparison'),
      h('p', { className: 'text-neutral-400 text-sm mt-1' }, 'Compare security features across ' + DEVICE_DATABASE.length + ' devices')
    ),

    // Filters
    h('div', { className: 'flex flex-wrap items-center gap-3' },
      h('div', { className: 'relative flex-1 min-w-[200px]' },
        h('div', { className: 'absolute left-3 top-1/2 -translate-y-1/2 text-neutral-500' }, h(IconSearch, { size: 16 })),
        h('input', {
          type: 'text', placeholder: 'Search devices...',
          className: 'w-full bg-neutral-900 border border-neutral-800 rounded-lg pl-10 pr-4 py-2.5 text-sm text-white placeholder:text-neutral-500 focus:outline-none focus:border-green-500/50',
          value: search,
          onChange: function(e) { setSearch(e.target.value); }
        })
      ),
      h('select', {
        className: 'bg-neutral-900 border border-neutral-800 rounded-lg px-3 py-2.5 text-sm text-white focus:outline-none focus:border-green-500/50',
        value: brandFilter,
        onChange: function(e) { setBrandFilter(e.target.value); }
      }, brands.map(function(b) { return h('option', { key: b, value: b }, b === 'ALL' ? 'All Brands' : b); })),
      h('select', {
        className: 'bg-neutral-900 border border-neutral-800 rounded-lg px-3 py-2.5 text-sm text-white focus:outline-none focus:border-green-500/50',
        value: sortBy,
        onChange: function(e) { setSortBy(e.target.value); }
      },
        h('option', { value: 'score' }, 'Sort by Score'),
        h('option', { value: 'name' }, 'Sort by Name'),
        h('option', { value: 'patch' }, 'Sort by Patch Date')
      )
    ),

    // Comparison panel
    compareList.length > 0 ? h('div', { className: 'bg-neutral-900 border border-green-500/30 rounded-xl p-6' },
      h('div', { className: 'flex items-center justify-between mb-4' },
        h('h2', { className: 'text-lg font-semibold text-white' }, 'Comparing ' + compareList.length + ' Devices'),
        h('button', {
          className: 'text-xs text-neutral-500 hover:text-red-400 transition-colors',
          onClick: function() { setCompareList([]); }
        }, 'Clear')
      ),
      h('div', { className: 'grid grid-cols-1 md:grid-cols-' + compareList.length + ' gap-4' },
        compareList.map(function(device) {
          return h('div', { key: device.name, className: 'bg-neutral-950 rounded-lg p-4 border border-neutral-800' },
            h('div', { className: 'text-center mb-3' },
              h(ScoreRing, { score: device.securityScore, size: 80, strokeWidth: 6 }),
              h('h3', { className: 'text-sm font-medium text-white mt-2' }, device.name)
            ),
            h('div', { className: 'space-y-2 text-xs' },
              h('div', { className: 'flex justify-between' }, h('span', { className: 'text-neutral-500' }, 'OS'), h('span', { className: 'text-neutral-300' }, device.os)),
              h('div', { className: 'flex justify-between' }, h('span', { className: 'text-neutral-500' }, 'Patch'), h('span', { className: 'text-neutral-300' }, device.securityPatch)),
              h('div', { className: 'flex justify-between' }, h('span', { className: 'text-neutral-500' }, 'Chipset'), h('span', { className: 'text-neutral-300' }, device.chipset)),
              h('div', { className: 'flex justify-between' }, h('span', { className: 'text-neutral-500' }, 'Updates'), h('span', { className: 'text-neutral-300' }, device.updateYears + ' years')),
              h('div', { className: 'flex justify-between' }, h('span', { className: 'text-neutral-500' }, 'Encryption'), h('span', { className: 'text-neutral-300' }, device.encryptionType)),
              h('div', { className: 'flex justify-between' }, h('span', { className: 'text-neutral-500' }, 'Biometrics'), h('span', { className: 'text-neutral-300' }, device.biometrics)),
              device.titanChip ? h('div', { className: 'flex justify-between' }, h('span', { className: 'text-neutral-500' }, 'Security Chip'), h('span', { className: 'text-green-400' }, 'Titan M2')) : null,
              device.vpnBuiltIn ? h('div', { className: 'flex justify-between' }, h('span', { className: 'text-neutral-500' }, 'Built-in VPN'), h('span', { className: 'text-green-400' }, 'Yes')) : null
            )
          );
        })
      )
    ) : null,

    // Device list
    h('div', { className: 'text-sm text-neutral-500 mb-2' }, filtered.length + ' devices' + (compareList.length < 3 ? ' - Click + to compare (max 3)' : '')),
    h('div', { className: 'grid grid-cols-1 md:grid-cols-2 gap-3' },
      filtered.map(function(device) {
        var isCompared = compareList.some(function(d) { return d.name === device.name; });
        return h('div', { key: device.name, className: 'bg-neutral-900 border border-neutral-800 rounded-xl p-4 hover:border-neutral-700 transition-colors' },
          h('div', { className: 'flex items-center justify-between' },
            h('div', { className: 'flex items-center gap-3 flex-1 min-w-0' },
              h('div', { className: 'w-10 h-10 rounded-lg bg-neutral-800 flex items-center justify-center flex-shrink-0' },
                h(IconSmartphone, { size: 18, className: 'text-green-400' })
              ),
              h('div', { className: 'min-w-0' },
                h('h3', { className: 'text-sm font-medium text-white truncate' }, device.name),
                h('p', { className: 'text-xs text-neutral-500' }, device.os + ' | Patch: ' + device.securityPatch)
              )
            ),
            h('div', { className: 'flex items-center gap-2 ml-2' },
              h('span', { className: 'text-lg font-bold ' + (device.securityScore >= 90 ? 'text-green-400' : device.securityScore >= 75 ? 'text-yellow-400' : device.securityScore >= 60 ? 'text-orange-400' : 'text-red-400') }, device.securityScore),
              h('button', {
                className: 'w-8 h-8 rounded-lg border flex items-center justify-center text-xs font-medium transition-colors ' + (isCompared ? 'bg-green-600 border-green-500 text-white' : 'border-neutral-700 text-neutral-400 hover:border-green-500 hover:text-green-400'),
                onClick: function() { toggleCompare(device); },
                disabled: !isCompared && compareList.length >= 3
              }, isCompared ? h(IconCheckCircle, { size: 14 }) : '+')
            )
          )
        );
      })
    )
  );
}


// ============================================================
// PAGE: WI-FI ANALYZER
// ============================================================

function WifiAnalyzerPage() {
  var ssidResult = useState('');
  var ssid = ssidResult[0];
  var setSsid = ssidResult[1];

  var secTypeResult = useState('WPA2');
  var secType = secTypeResult[0];
  var setSecType = secTypeResult[1];

  var signalResult = useState(75);
  var signal = signalResult[0];
  var setSignal = signalResult[1];

  var resultState = useState(null);
  var result = resultState[0];
  var setResult = resultState[1];

  var histState = useState([]);
  var history = histState[0];
  var setHistory = histState[1];

  function handleAnalyze() {
    if (!ssid.trim()) return;
    var analysis = SecurityServices.analyzeWifi(ssid, secType, signal);
    setResult(analysis);
    setHistory(function(prev) { return [analysis].concat(prev).slice(0, 10); });
  }

  return h('div', { className: 'space-y-6 animate-fade-in' },
    h('div', null,
      h('h1', { className: 'text-2xl font-bold text-white' }, 'Wi-Fi Analyzer'),
      h('p', { className: 'text-neutral-400 text-sm mt-1' }, 'Analyze wireless network security configuration')
    ),

    // Input form
    h('div', { className: 'bg-neutral-900 border border-neutral-800 rounded-xl p-6' },
      h('div', { className: 'grid grid-cols-1 md:grid-cols-2 gap-4' },
        h('div', null,
          h('label', { className: 'text-sm text-neutral-400 block mb-1.5' }, 'Network Name (SSID)'),
          h('input', {
            type: 'text', placeholder: 'e.g., MyHomeNetwork',
            className: 'w-full bg-neutral-950 border border-neutral-800 rounded-lg px-4 py-2.5 text-sm text-white placeholder:text-neutral-500 focus:outline-none focus:border-green-500/50',
            value: ssid,
            onChange: function(e) { setSsid(e.target.value); }
          })
        ),
        h('div', null,
          h('label', { className: 'text-sm text-neutral-400 block mb-1.5' }, 'Security Type'),
          h('select', {
            className: 'w-full bg-neutral-950 border border-neutral-800 rounded-lg px-4 py-2.5 text-sm text-white focus:outline-none focus:border-green-500/50',
            value: secType,
            onChange: function(e) { setSecType(e.target.value); }
          },
            h('option', { value: 'WPA3' }, 'WPA3'),
            h('option', { value: 'WPA2' }, 'WPA2'),
            h('option', { value: 'WPA' }, 'WPA (TKIP)'),
            h('option', { value: 'WEP' }, 'WEP'),
            h('option', { value: 'OPEN' }, 'Open (No Encryption)')
          )
        )
      ),
      h('div', { className: 'mt-4' },
        h('label', { className: 'text-sm text-neutral-400 block mb-1.5' }, 'Signal Strength: ' + signal + '%'),
        h('input', {
          type: 'range', min: 0, max: 100, value: signal,
          className: 'w-full accent-green-500',
          onChange: function(e) { setSignal(parseInt(e.target.value)); }
        })
      ),
      h('button', {
        className: 'mt-4 px-6 py-2.5 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium text-sm transition-colors inline-flex items-center gap-2',
        onClick: handleAnalyze,
        disabled: !ssid.trim()
      }, h(IconWifi, { size: 16 }), 'Analyze Network')
    ),

    // Results
    result ? h('div', { className: 'bg-neutral-900 border border-neutral-800 rounded-xl p-6 animate-slide-up' },
      h('div', { className: 'flex items-center justify-between mb-4' },
        h('h2', { className: 'text-lg font-semibold text-white' }, 'Analysis: ' + result.ssid),
        h(ScoreRing, { score: result.score, size: 80, strokeWidth: 6, label: 'Safety' })
      ),

      result.issues.length > 0 ? h('div', { className: 'space-y-2 mb-4' },
        h('h3', { className: 'text-sm font-medium text-neutral-300 mb-2' }, 'Issues Found'),
        result.issues.map(function(issue, i) {
          return h('div', { key: i, className: 'flex items-start gap-3 p-3 bg-neutral-950 rounded-lg border border-neutral-800' },
            h(SeverityBadge, { severity: issue.severity }),
            h('span', { className: 'text-sm text-neutral-300' }, issue.message)
          );
        })
      ) : h('div', { className: 'flex items-center gap-2 mb-4 p-3 bg-green-500/10 border border-green-500/20 rounded-lg' },
        h(IconCheckCircle, { size: 16, className: 'text-green-400' }),
        h('span', { className: 'text-sm text-green-400' }, 'No critical issues found')
      ),

      result.recommendations.length > 0 ? h('div', null,
        h('h3', { className: 'text-sm font-medium text-neutral-300 mb-2' }, 'Recommendations'),
        h('ul', { className: 'space-y-1' },
          result.recommendations.map(function(rec, i) {
            return h('li', { key: i, className: 'flex items-center gap-2 text-sm text-neutral-400' },
              h(IconArrowRight, { size: 12, className: 'text-green-400 flex-shrink-0' }),
              rec
            );
          })
        )
      ) : null
    ) : null,

    // History
    history.length > 0 ? h('div', { className: 'bg-neutral-900 border border-neutral-800 rounded-xl p-6' },
      h('div', { className: 'flex items-center justify-between mb-4' },
        h('h2', { className: 'text-lg font-semibold text-white' }, 'Analysis History'),
        h('button', {
          className: 'text-xs text-neutral-500 hover:text-red-400 transition-colors flex items-center gap-1',
          onClick: function() { setHistory([]); }
        }, h(IconTrash, { size: 12 }), 'Clear')
      ),
      h('div', { className: 'space-y-2' },
        history.map(function(item, i) {
          return h('div', { key: i, className: 'flex items-center justify-between py-2 border-b border-neutral-800 last:border-0' },
            h('div', { className: 'flex items-center gap-2' },
              h(IconWifi, { size: 14, className: 'text-neutral-500' }),
              h('span', { className: 'text-sm text-neutral-300' }, item.ssid)
            ),
            h('div', { className: 'flex items-center gap-2' },
              h('span', { className: 'text-xs text-neutral-500' }, item.issues.length + ' issues'),
              h('span', { className: 'text-xs font-medium ' + (item.score >= 80 ? 'text-green-400' : item.score >= 50 ? 'text-yellow-400' : 'text-red-400') }, item.score + '/100')
            )
          );
        })
      )
    ) : null
  );
}


// ============================================================
// PAGE: OSINT CHECKER
// ============================================================

function OsintCheckerPage() {
  var emailResult = useState('');
  var email = emailResult[0];
  var setEmail = emailResult[1];

  var resultState = useState(null);
  var result = resultState[0];
  var setResult = resultState[1];

  var loadState = useState(false);
  var loading = loadState[0];
  var setLoading = loadState[1];

  function handleCheck() {
    if (!email.trim() || !email.includes('@')) return;
    setLoading(true);
    SecurityServices.checkBreach(email).then(function(data) {
      setResult(data);
      setLoading(false);
    });
  }

  return h('div', { className: 'space-y-6 animate-fade-in' },
    h('div', null,
      h('h1', { className: 'text-2xl font-bold text-white' }, 'OSINT / Breach Checker'),
      h('p', { className: 'text-neutral-400 text-sm mt-1' }, 'Check if an email appears in known data breaches')
    ),

    // Input
    h('div', { className: 'bg-neutral-900 border border-neutral-800 rounded-xl p-6' },
      h('div', { className: 'flex gap-3' },
        h('div', { className: 'relative flex-1' },
          h('div', { className: 'absolute left-3 top-1/2 -translate-y-1/2 text-neutral-500' }, h(IconUser, { size: 16 })),
          h('input', {
            type: 'email', placeholder: 'Enter email address to check...',
            className: 'w-full bg-neutral-950 border border-neutral-800 rounded-lg pl-10 pr-4 py-3 text-sm text-white placeholder:text-neutral-500 focus:outline-none focus:border-green-500/50',
            value: email,
            onChange: function(e) { setEmail(e.target.value); },
            onKeyDown: function(e) { if (e.key === 'Enter') handleCheck(); }
          })
        ),
        h('button', {
          className: 'px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium text-sm transition-colors flex items-center gap-2 disabled:opacity-50',
          onClick: handleCheck,
          disabled: loading || !email.includes('@')
        }, loading ? h('span', { className: 'animate-scan-pulse' }, 'Checking...') : h(React.Fragment, null, h(IconSearch, { size: 16 }), 'Check'))
      ),
      h('p', { className: 'text-xs text-neutral-600 mt-2' }, 'Demo mode: Results are simulated for privacy. Try any email address.')
    ),

    // Results
    result ? h('div', { className: 'animate-slide-up space-y-4' },
      // Summary
      h('div', { className: 'bg-neutral-900 border border-neutral-800 rounded-xl p-6' },
        h('div', { className: 'flex items-center justify-between mb-4' },
          h('div', null,
            h('h2', { className: 'text-lg font-semibold text-white' }, 'Results for ' + result.email),
            h('p', { className: 'text-sm text-neutral-500 mt-1' }, 'Found in ' + result.breachCount + ' known breach(es)')
          ),
          result.breachCount > 0
            ? h(IconXCircle, { size: 32, className: 'text-red-400' })
            : h(IconCheckCircle, { size: 32, className: 'text-green-400' })
        ),

        result.breachCount > 0 ? h('div', { className: 'space-y-3' },
          result.breaches.map(function(breach, i) {
            return h('div', { key: i, className: 'p-4 bg-neutral-950 rounded-lg border border-neutral-800' },
              h('div', { className: 'flex items-center justify-between mb-2' },
                h('h3', { className: 'text-sm font-medium text-white' }, breach.name),
                h('span', { className: 'text-xs text-neutral-500' }, breach.date)
              ),
              h('div', { className: 'flex items-center gap-4 text-xs text-neutral-400 mb-2' },
                h('span', null, (breach.records / 1000000).toFixed(1) + 'M records'),
                h('span', null, breach.dataTypes.length + ' data types exposed')
              ),
              h('div', { className: 'flex flex-wrap gap-1' },
                breach.dataTypes.map(function(dt, j) {
                  return h('span', { key: j, className: 'px-2 py-0.5 text-xs bg-red-500/10 text-red-400 rounded border border-red-500/20' }, dt);
                })
              )
            );
          })
        ) : h('div', { className: 'text-center py-6' },
          h(IconCheckCircle, { size: 48, className: 'mx-auto text-green-400/30 mb-2' }),
          h('p', { className: 'text-neutral-400 text-sm' }, 'No known breaches found for this email')
        )
      ),

      // Recommendation
      h('div', { className: 'p-4 rounded-xl border ' + (result.breachCount > 0 ? 'bg-red-500/5 border-red-500/20' : 'bg-green-500/5 border-green-500/20') },
        h('div', { className: 'flex items-start gap-3' },
          result.breachCount > 0 ? h(IconAlertTriangle, { size: 18, className: 'text-red-400 mt-0.5' }) : h(IconCheckCircle, { size: 18, className: 'text-green-400 mt-0.5' }),
          h('div', null,
            h('h3', { className: 'text-sm font-medium ' + (result.breachCount > 0 ? 'text-red-400' : 'text-green-400') }, 'Recommendation'),
            h('p', { className: 'text-sm text-neutral-400 mt-1' }, result.recommendation),
            result.breachCount > 0 ? h('ul', { className: 'text-xs text-neutral-500 mt-2 space-y-1 list-disc list-inside' },
              h('li', null, 'Change passwords on affected services immediately'),
              h('li', null, 'Enable two-factor authentication (2FA) where available'),
              h('li', null, 'Use a unique password for each service'),
              h('li', null, 'Consider using a password manager')
            ) : null
          )
        )
      )
    ) : null
  );
}


// ============================================================
// PAGE: AI ASSISTANT
// ============================================================

function AiAssistantPage() {
  var messagesResult = useState([
    { role: 'assistant', content: 'Hello! I am the ExploitGuard Security Assistant. I can help you understand vulnerabilities, security concepts, and best practices. Ask me anything about:\n\n- CVE details and impact\n- Device security comparisons\n- Best practices for mobile security\n- How to protect against specific threats\n- Security terminology explanations\n\nWhat would you like to know?' }
  ]);
  var messages = messagesResult[0];
  var setMessages = messagesResult[1];

  var inputResult = useState('');
  var input = inputResult[0];
  var setInput = inputResult[1];

  var loadState = useState(false);
  var loading = loadState[0];
  var setLoading = loadState[1];

  var messagesEndRef = useRef(null);

  useEffect(function() {
    if (messagesEndRef.current) {
      messagesEndRef.current.scrollIntoView({ behavior: 'smooth' });
    }
  }, [messages]);

  // Local AI response generation (no API needed)
  function generateResponse(question) {
    var q = question.toLowerCase();
    
    // CVE lookups
    var cveMatch = q.match(/cve-\d{4}-\d+/i);
    if (cveMatch) {
      var cve = CVE_DATABASE.find(function(c) { return c.id.toLowerCase() === cveMatch[0].toLowerCase(); });
      if (cve) {
        return 'Here is what I know about **' + cve.id + '**:\n\n' +
          '**' + cve.title + '**\n\n' +
          cve.description + '\n\n' +
          '- **Severity:** ' + cve.severity + ' (CVSS ' + cve.cvss + ')\n' +
          '- **Affected:** ' + cve.affected + '\n' +
          '- **Vector:** ' + cve.vector + '\n' +
          '- **Category:** ' + cve.category + '\n' +
          '- **Published:** ' + cve.published + '\n' +
          '- **Patched:** ' + cve.patched + '\n' +
          '- **Exploited in Wild:** ' + (cve.exploitedInWild ? 'Yes - active exploitation reported' : 'No known exploitation') + '\n\n' +
          'You can view the full details on the National Vulnerability Database.';
      }
      return 'I don\'t have that specific CVE in my database. I track 12 major Android CVEs. Try asking about one of these: ' + CVE_DATABASE.map(function(c) { return c.id; }).join(', ');
    }

    // Device queries
    if (q.includes('pixel') || q.includes('samsung') || q.includes('iphone') || q.includes('device') || q.includes('phone') || q.includes('compare')) {
      if (q.includes('most secure') || q.includes('best') || q.includes('safest')) {
        var top3 = DEVICE_DATABASE.slice().sort(function(a, b) { return b.securityScore - a.securityScore; }).slice(0, 3);
        return 'Based on my security analysis, the most secure devices are:\n\n' +
          top3.map(function(d, i) { return (i + 1) + '. **' + d.name + '** (Score: ' + d.securityScore + '/100) - ' + d.os + ', ' + d.updateYears + ' years of updates'; }).join('\n') +
          '\n\nKey factors in security scoring include: update frequency, patch recency, encryption type, biometric options, and hardware security features like dedicated security chips.';
      }
      var deviceMatch = DEVICE_DATABASE.find(function(d) { return q.includes(d.name.toLowerCase()); });
      if (deviceMatch) {
        return '**' + deviceMatch.name + '** Security Profile:\n\n' +
          '- **Score:** ' + deviceMatch.securityScore + '/100\n' +
          '- **OS:** ' + deviceMatch.os + '\n' +
          '- **Latest Patch:** ' + deviceMatch.securityPatch + '\n' +
          '- **Chipset:** ' + deviceMatch.chipset + '\n' +
          '- **Update Support:** ' + deviceMatch.updateYears + ' years (' + deviceMatch.updateFrequency + ')\n' +
          '- **Encryption:** ' + deviceMatch.encryptionType + '\n' +
          '- **Biometrics:** ' + deviceMatch.biometrics + '\n' +
          (deviceMatch.titanChip ? '- **Security Chip:** Titan M2 hardware security module\n' : '') +
          (deviceMatch.vpnBuiltIn ? '- **Built-in VPN:** Google One VPN included\n' : '');
      }
      return 'I have security data on ' + DEVICE_DATABASE.length + ' devices across Google Pixel, Samsung Galaxy, Apple iPhone, OnePlus, Xiaomi, Nothing, Motorola, and Sony. Ask about a specific device or which is the most secure!';
    }

    // Security topics
    if (q.includes('phishing') || q.includes('phish')) {
      return '**Phishing Protection Guide:**\n\n' +
        'Phishing is a social engineering attack where attackers create fake websites or emails to steal credentials.\n\n' +
        '**How to identify phishing:**\n' +
        '1. Check the URL carefully for misspellings (e.g., g00gle.com)\n' +
        '2. Look for suspicious TLDs (.tk, .xyz, .buzz)\n' +
        '3. Verify HTTPS is present (though phishing sites can have HTTPS too)\n' +
        '4. Be wary of urgent language ("Your account will be suspended!")\n' +
        '5. Check the sender\'s email address carefully\n\n' +
        '**Prevention:**\n' +
        '- Use our URL Scanner to check suspicious links\n' +
        '- Enable 2FA on all accounts\n' +
        '- Never enter credentials after clicking email links\n' +
        '- Use a password manager (it won\'t autofill on fake sites)';
    }

    if (q.includes('2fa') || q.includes('two-factor') || q.includes('two factor') || q.includes('mfa')) {
      return '**Two-Factor Authentication (2FA):**\n\n' +
        '2FA adds a second layer of security beyond your password.\n\n' +
        '**Types of 2FA (ranked by security):**\n' +
        '1. **Hardware Keys** (YubiKey, Titan Key) - Most secure, phishing resistant\n' +
        '2. **Authenticator Apps** (Google Authenticator, Authy) - Strong, offline capable\n' +
        '3. **Push Notifications** (Google/Apple prompts) - Convenient, moderately secure\n' +
        '4. **SMS Codes** - Better than nothing, but vulnerable to SIM swapping\n\n' +
        '**Recommendation:** Use hardware keys for critical accounts (email, banking) and authenticator apps for everything else. Avoid SMS 2FA if possible.';
    }

    if (q.includes('vpn')) {
      return '**VPN (Virtual Private Network) Guide:**\n\n' +
        'A VPN encrypts your internet traffic and masks your IP address.\n\n' +
        '**When to use a VPN:**\n' +
        '- On public Wi-Fi networks\n' +
        '- When accessing sensitive data remotely\n' +
        '- To prevent ISP tracking\n\n' +
        '**What a VPN does NOT do:**\n' +
        '- Make you anonymous (the VPN provider can see your traffic)\n' +
        '- Protect against malware or phishing\n' +
        '- Speed up your connection (it typically slows it slightly)\n\n' +
        '**Choosing a VPN:**\n' +
        '- Look for no-log policies (independently audited)\n' +
        '- WireGuard protocol is fastest and most modern\n' +
        '- Avoid free VPNs (they often sell your data)\n' +
        '- Google Pixel phones include a built-in VPN';
    }

    if (q.includes('password')) {
      return '**Password Security Best Practices:**\n\n' +
        '1. **Use a password manager** (Bitwarden, 1Password, KeePassXC)\n' +
        '2. **Generate random passwords** - minimum 16 characters\n' +
        '3. **Never reuse passwords** across services\n' +
        '4. **Enable 2FA** on every account that supports it\n' +
        '5. **Use passphrases** for passwords you must remember (e.g., "correct-horse-battery-staple")\n\n' +
        '**Check for breaches:** Use our OSINT Checker to see if your email appears in known data breaches.';
    }

    if (q.includes('encryption') || q.includes('encrypt')) {
      return '**Encryption on Mobile Devices:**\n\n' +
        '**Android:**\n' +
        '- Uses File-Based Encryption (FBE) with AES-256\n' +
        '- Each file encrypted with unique key derived from user credentials\n' +
        '- Direct Boot allows alarm/phone to work before unlock\n\n' +
        '**iOS:**\n' +
        '- Hardware AES-256-XTS encryption with Secure Enclave\n' +
        '- Per-file keys with class-based access control\n' +
        '- Keys destroyed on 10 failed passcode attempts (if enabled)\n\n' +
        '**Recommendations:**\n' +
        '- Use a strong PIN (6+ digits) or alphanumeric passcode\n' +
        '- Enable biometric unlock for convenience\n' +
        '- Ensure your device encryption is active in Settings > Security';
    }

    if (q.includes('exploit') || q.includes('vulnerability') || q.includes('attack')) {
      return '**Common Mobile Attack Vectors:**\n\n' +
        '1. **Privilege Escalation** - Gaining unauthorized elevated access\n' +
        '2. **Remote Code Execution (RCE)** - Running code remotely on victim device\n' +
        '3. **Memory Corruption** - Buffer overflows, use-after-free bugs\n' +
        '4. **Information Disclosure** - Leaking sensitive data unintentionally\n' +
        '5. **Man-in-the-Middle (MitM)** - Intercepting network traffic\n\n' +
        '**Protection:**\n' +
        '- Keep your device and apps updated\n' +
        '- Only install apps from official stores\n' +
        '- Review app permissions regularly\n' +
        '- Use our Vulnerability Scanner to check known CVEs\n\n' +
        'I currently track ' + CVE_DATABASE.length + ' Android CVEs, including ' + CVE_DATABASE.filter(function(c) { return c.exploitedInWild; }).length + ' that have been exploited in the wild.';
    }

    // Default response
    return 'That is a great question! Here are some topics I can help you with:\n\n' +
      '- **CVE Details**: Ask about specific CVEs (e.g., "Tell me about CVE-2024-53104")\n' +
      '- **Device Security**: "Which phone is most secure?" or ask about a specific device\n' +
      '- **Security Concepts**: phishing, 2FA, VPNs, passwords, encryption\n' +
      '- **Attack Vectors**: exploits, vulnerabilities, and how to protect yourself\n\n' +
      'Try asking something more specific and I will do my best to help!';
  }

  function handleSend() {
    if (!input.trim() || loading) return;
    var userMsg = { role: 'user', content: input };
    setMessages(function(prev) { return prev.concat([userMsg]); });
    setInput('');
    setLoading(true);

    setTimeout(function() {
      var response = generateResponse(input);
      setMessages(function(prev) { return prev.concat([{ role: 'assistant', content: response }]); });
      setLoading(false);
    }, 600 + Math.random() * 800);
  }

  // Quick questions
  var quickQuestions = [
    'Tell me about CVE-2025-27363',
    'Which phone is most secure?',
    'How does phishing work?',
    'Explain 2FA options'
  ];

  return h('div', { className: 'flex flex-col h-[calc(100vh-2rem)] animate-fade-in' },
    h('div', { className: 'mb-4' },
      h('h1', { className: 'text-2xl font-bold text-white' }, 'AI Security Assistant'),
      h('p', { className: 'text-neutral-400 text-sm mt-1' }, 'Ask questions about security, vulnerabilities, and best practices')
    ),

    // Messages
    h('div', { className: 'flex-1 overflow-y-auto scrollbar-hide space-y-4 mb-4 pr-1' },
      messages.map(function(msg, i) {
        var isUser = msg.role === 'user';
        return h('div', { key: i, className: 'flex gap-3 ' + (isUser ? 'flex-row-reverse' : '') },
          h('div', { className: 'w-8 h-8 rounded-lg flex items-center justify-center flex-shrink-0 ' + (isUser ? 'bg-green-600' : 'bg-neutral-800') },
            isUser ? h(IconUser, { size: 14 }) : h(IconBot, { size: 14 })
          ),
          h('div', { className: 'max-w-[80%] p-3 rounded-xl text-sm leading-relaxed ' + (isUser ? 'bg-green-600/20 text-green-100 border border-green-500/20' : 'bg-neutral-900 text-neutral-300 border border-neutral-800') },
            msg.content.split('\n').map(function(line, j) {
              if (line.startsWith('**') && line.endsWith('**')) {
                return h('p', { key: j, className: 'font-semibold text-white my-1' }, line.replace(/\*\*/g, ''));
              }
              if (line.startsWith('- **')) {
                var parts = line.replace(/^- /, '').split('**');
                return h('p', { key: j, className: 'ml-2 my-0.5' },
                  h('span', { className: 'font-medium text-white' }, parts[1] || ''),
                  parts[2] || ''
                );
              }
              if (line.match(/^\d+\.\s\*\*/)) {
                var parts2 = line.split('**');
                return h('p', { key: j, className: 'ml-2 my-0.5' },
                  parts2[0],
                  h('span', { className: 'font-medium text-white' }, parts2[1] || ''),
                  parts2[2] || ''
                );
              }
              if (line.startsWith('- ')) {
                return h('p', { key: j, className: 'ml-2 my-0.5' }, line);
              }
              if (line === '') {
                return h('br', { key: j });
              }
              return h('p', { key: j, className: 'my-0.5' }, line);
            })
          )
        );
      }),
      loading ? h('div', { className: 'flex gap-3' },
        h('div', { className: 'w-8 h-8 rounded-lg bg-neutral-800 flex items-center justify-center' }, h(IconBot, { size: 14 })),
        h('div', { className: 'bg-neutral-900 border border-neutral-800 rounded-xl p-3' },
          h('div', { className: 'flex gap-1' },
            h('span', { className: 'w-2 h-2 bg-neutral-500 rounded-full animate-bounce', style: { animationDelay: '0ms' } }),
            h('span', { className: 'w-2 h-2 bg-neutral-500 rounded-full animate-bounce', style: { animationDelay: '150ms' } }),
            h('span', { className: 'w-2 h-2 bg-neutral-500 rounded-full animate-bounce', style: { animationDelay: '300ms' } })
          )
        )
      ) : null,
      h('div', { ref: messagesEndRef })
    ),

    // Quick questions
    messages.length <= 1 ? h('div', { className: 'flex flex-wrap gap-2 mb-3' },
      quickQuestions.map(function(q) {
        return h('button', {
          key: q,
          className: 'px-3 py-1.5 bg-neutral-900 border border-neutral-800 rounded-lg text-xs text-neutral-400 hover:border-green-500/50 hover:text-green-400 transition-colors',
          onClick: function() { setInput(q); }
        }, q);
      })
    ) : null,

    // Input
    h('div', { className: 'flex gap-3' },
      h('input', {
        type: 'text',
        placeholder: 'Ask about security, CVEs, devices...',
        className: 'flex-1 bg-neutral-900 border border-neutral-800 rounded-lg px-4 py-3 text-sm text-white placeholder:text-neutral-500 focus:outline-none focus:border-green-500/50',
        value: input,
        onChange: function(e) { setInput(e.target.value); },
        onKeyDown: function(e) { if (e.key === 'Enter') handleSend(); }
      }),
      h('button', {
        className: 'px-4 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors disabled:opacity-50',
        onClick: handleSend,
        disabled: !input.trim() || loading
      }, h(IconSend, { size: 18 }))
    )
  );
}


// ============================================================
// PAGE: SECURITY HISTORY
// ============================================================

function SecurityHistoryPage() {
  var histState = useState(function() {
    // Generate sample security events
    var events = [
      { id: 1, type: 'scan', title: 'URL Scan: google.com', result: 'safe', score: 100, timestamp: new Date(Date.now() - 3600000).toISOString() },
      { id: 2, type: 'cve', title: 'CVE-2025-27363 Alert', result: 'critical', score: null, timestamp: new Date(Date.now() - 7200000).toISOString() },
      { id: 3, type: 'file', title: 'File Scan: document.pdf', result: 'safe', score: null, timestamp: new Date(Date.now() - 10800000).toISOString() },
      { id: 4, type: 'wifi', title: 'Wi-Fi Analysis: HomeNetwork', result: 'warning', score: 85, timestamp: new Date(Date.now() - 14400000).toISOString() },
      { id: 5, type: 'scan', title: 'URL Scan: suspicious-site.tk', result: 'danger', score: 25, timestamp: new Date(Date.now() - 18000000).toISOString() },
      { id: 6, type: 'breach', title: 'Breach Check: user@email.com', result: 'warning', score: null, timestamp: new Date(Date.now() - 21600000).toISOString() },
      { id: 7, type: 'permission', title: 'Permission Audit', result: 'safe', score: null, timestamp: new Date(Date.now() - 86400000).toISOString() },
      { id: 8, type: 'cve', title: 'CVE-2024-53104 Patch Released', result: 'info', score: null, timestamp: new Date(Date.now() - 172800000).toISOString() },
      { id: 9, type: 'scan', title: 'URL Scan: amaz0n-login.xyz', result: 'danger', score: 10, timestamp: new Date(Date.now() - 259200000).toISOString() },
      { id: 10, type: 'file', title: 'File Scan: update.apk', result: 'danger', score: null, timestamp: new Date(Date.now() - 345600000).toISOString() }
    ];
    return events;
  });
  var history = histState[0];
  var setHistory = histState[1];

  var filterState = useState('ALL');
  var filter = filterState[0];
  var setFilter = filterState[1];

  function resultColor(result) {
    if (result === 'safe') return 'text-green-400';
    if (result === 'warning') return 'text-yellow-400';
    if (result === 'danger' || result === 'critical') return 'text-red-400';
    return 'text-blue-400';
  }

  function resultBg(result) {
    if (result === 'safe') return 'bg-green-500/10 border-green-500/20';
    if (result === 'warning') return 'bg-yellow-500/10 border-yellow-500/20';
    if (result === 'danger' || result === 'critical') return 'bg-red-500/10 border-red-500/20';
    return 'bg-blue-500/10 border-blue-500/20';
  }

  function typeIcon(type) {
    if (type === 'scan') return h(IconGlobe, { size: 16 });
    if (type === 'cve') return h(IconBug, { size: 16 });
    if (type === 'file') return h(IconFile, { size: 16 });
    if (type === 'wifi') return h(IconWifi, { size: 16 });
    if (type === 'breach') return h(IconUser, { size: 16 });
    if (type === 'permission') return h(IconLock, { size: 16 });
    return h(IconShield, { size: 16 });
  }

  function timeAgo(isoString) {
    var seconds = Math.floor((new Date() - new Date(isoString)) / 1000);
    if (seconds < 60) return seconds + 's ago';
    var minutes = Math.floor(seconds / 60);
    if (minutes < 60) return minutes + 'm ago';
    var hours = Math.floor(minutes / 60);
    if (hours < 24) return hours + 'h ago';
    var days = Math.floor(hours / 24);
    return days + 'd ago';
  }

  var filtered = filter === 'ALL' ? history : history.filter(function(e) { return e.type === filter; });
  var safeCount = history.filter(function(e) { return e.result === 'safe'; }).length;
  var dangerCount = history.filter(function(e) { return e.result === 'danger' || e.result === 'critical'; }).length;

  return h('div', { className: 'space-y-6 animate-fade-in' },
    h('div', null,
      h('h1', { className: 'text-2xl font-bold text-white' }, 'Security History'),
      h('p', { className: 'text-neutral-400 text-sm mt-1' }, 'Review past security scans and alerts')
    ),

    // Stats
    h('div', { className: 'grid grid-cols-2 md:grid-cols-4 gap-4' },
      h(StatCard, { label: 'Total Events', value: history.length, icon: h(IconBarChart, { size: 18 }) }),
      h(StatCard, { label: 'Safe Results', value: safeCount, icon: h(IconCheckCircle, { size: 18, className: 'text-green-400' }) }),
      h(StatCard, { label: 'Threats Detected', value: dangerCount, icon: h(IconAlertTriangle, { size: 18, className: 'text-red-400' }) }),
      h(StatCard, { label: 'Detection Rate', value: (history.length > 0 ? Math.round((dangerCount / history.length) * 100) : 0) + '%', icon: h(IconTrendingUp, { size: 18 }) })
    ),

    // Filters
    h('div', { className: 'flex flex-wrap gap-2' },
      ['ALL', 'scan', 'cve', 'file', 'wifi', 'breach', 'permission'].map(function(f) {
        return h('button', {
          key: f,
          className: 'px-3 py-1.5 rounded-lg text-xs font-medium border transition-colors ' + (filter === f ? 'bg-green-600/20 border-green-500/30 text-green-400' : 'bg-neutral-900 border-neutral-800 text-neutral-400 hover:border-neutral-700'),
          onClick: function() { setFilter(f); }
        }, f === 'ALL' ? 'All Events' : f.charAt(0).toUpperCase() + f.slice(1));
      })
    ),

    // Event list
    h('div', { className: 'space-y-2' },
      filtered.map(function(event) {
        return h('div', { key: event.id, className: 'bg-neutral-900 border border-neutral-800 rounded-xl p-4 hover:border-neutral-700 transition-colors' },
          h('div', { className: 'flex items-center justify-between' },
            h('div', { className: 'flex items-center gap-3' },
              h('div', { className: 'w-8 h-8 rounded-lg bg-neutral-800 flex items-center justify-center text-neutral-400' }, typeIcon(event.type)),
              h('div', null,
                h('h3', { className: 'text-sm font-medium text-white' }, event.title),
                h('div', { className: 'flex items-center gap-2 mt-0.5' },
                  h('span', { className: 'text-xs text-neutral-500' }, timeAgo(event.timestamp)),
                  h('span', { className: 'text-xs capitalize px-2 py-0.5 rounded-full border ' + resultBg(event.result) + ' ' + resultColor(event.result) }, event.result)
                )
              )
            ),
            event.score !== null ? h('div', { className: 'text-right' },
              h('span', { className: 'text-lg font-bold ' + (event.score >= 70 ? 'text-green-400' : event.score >= 40 ? 'text-yellow-400' : 'text-red-400') }, event.score),
              h('span', { className: 'text-xs text-neutral-500 block' }, '/100')
            ) : null
          )
        );
      })
    ),

    filtered.length === 0 ? h('div', { className: 'text-center py-12 text-neutral-500' },
      h(IconClock, { size: 48, className: 'mx-auto mb-3 opacity-30' }),
      h('p', null, 'No events match this filter')
    ) : null,

    // Clear history
    h('div', { className: 'text-center' },
      h('button', {
        className: 'text-xs text-neutral-600 hover:text-red-400 transition-colors inline-flex items-center gap-1',
        onClick: function() { setHistory([]); }
      }, h(IconTrash, { size: 12 }), 'Clear all history')
    )
  );
}


// ============================================================
// SIDEBAR NAVIGATION
// ============================================================

var NAV_ITEMS = [
  { id: 'dashboard', label: 'Dashboard', icon: IconBarChart },
  { id: 'vulns', label: 'Vulnerability Scanner', icon: IconBug },
  { id: 'url', label: 'URL Scanner', icon: IconGlobe },
  { id: 'permissions', label: 'Permission Audit', icon: IconLock },
  { id: 'files', label: 'File Scanner', icon: IconFile },
  { id: 'devices', label: 'Device Comparison', icon: IconSmartphone },
  { id: 'wifi', label: 'Wi-Fi Analyzer', icon: IconWifi },
  { id: 'osint', label: 'OSINT Checker', icon: IconRadio },
  { id: 'ai', label: 'AI Assistant', icon: IconSparkles },
  { id: 'history', label: 'Security History', icon: IconClock }
];

function Sidebar(props) {
  var activePage = props.activePage;
  var setActivePage = props.setActivePage;
  var isOpen = props.isOpen;
  var setIsOpen = props.setIsOpen;

  return h(React.Fragment, null,
    // Mobile overlay
    isOpen ? h('div', {
      className: 'fixed inset-0 bg-black/50 z-40 lg:hidden',
      onClick: function() { setIsOpen(false); }
    }) : null,

    // Sidebar
    h('aside', {
      className: 'fixed top-0 left-0 h-full bg-neutral-950 border-r border-neutral-800 z-50 transition-transform duration-300 w-64 ' + (isOpen ? 'translate-x-0' : '-translate-x-full lg:translate-x-0')
    },
      // Logo area
      h('div', { className: 'p-4 border-b border-neutral-800' },
        h('div', { className: 'flex items-center justify-between' },
          h('div', { className: 'flex items-center gap-2' },
            h(IconShield, { size: 24, className: 'text-green-500' }),
            h('div', null,
              h('h1', { className: 'text-lg font-bold text-white leading-tight' }, 'ExploitGuard'),
              h('p', { className: 'text-[10px] text-neutral-500 tracking-wider uppercase' }, 'Security Suite')
            )
          ),
          h('button', {
            className: 'lg:hidden text-neutral-400 hover:text-white',
            onClick: function() { setIsOpen(false); }
          }, h(IconX, { size: 20 }))
        )
      ),

      // Navigation
      h('nav', { className: 'p-3 space-y-1 overflow-y-auto scrollbar-hide', style: { height: 'calc(100% - 130px)' } },
        NAV_ITEMS.map(function(item) {
          var isActive = activePage === item.id;
          return h('button', {
            key: item.id,
            className: 'w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm transition-colors ' + (isActive ? 'bg-green-600/15 text-green-400 font-medium' : 'text-neutral-400 hover:bg-neutral-900 hover:text-neutral-200'),
            onClick: function() {
              setActivePage(item.id);
              setIsOpen(false);
            }
          },
            h(item.icon, { size: 18 }),
            item.label
          );
        })
      ),

      // Footer
      h('div', { className: 'absolute bottom-0 left-0 right-0 p-4 border-t border-neutral-800' },
        h('div', { className: 'flex items-center gap-2 text-xs text-neutral-600' },
          h(IconShield, { size: 12 }),
          h('span', null, 'v1.0.0 - All scans run locally')
        )
      )
    )
  );
}

// ============================================================
// MAIN APP
// ============================================================

function App() {
  var pageResult = useState('dashboard');
  var activePage = pageResult[0];
  var setActivePage = pageResult[1];

  var sidebarResult = useState(false);
  var sidebarOpen = sidebarResult[0];
  var setSidebarOpen = sidebarResult[1];

  function renderPage() {
    switch (activePage) {
      case 'dashboard': return h(DashboardPage);
      case 'vulns': return h(VulnerabilityScannerPage);
      case 'url': return h(UrlScannerPage);
      case 'permissions': return h(PermissionAuditPage);
      case 'files': return h(FileScannerPage);
      case 'devices': return h(DeviceComparisonPage);
      case 'wifi': return h(WifiAnalyzerPage);
      case 'osint': return h(OsintCheckerPage);
      case 'ai': return h(AiAssistantPage);
      case 'history': return h(SecurityHistoryPage);
      default: return h(DashboardPage);
    }
  }

  var currentNav = NAV_ITEMS.find(function(n) { return n.id === activePage; });

  return h('div', { className: 'min-h-screen bg-[#0a0a0a] text-neutral-200 font-sans' },
    h(Sidebar, { activePage: activePage, setActivePage: setActivePage, isOpen: sidebarOpen, setIsOpen: setSidebarOpen }),

    // Main content area
    h('div', { className: 'lg:ml-64 min-h-screen' },
      // Mobile header
      h('header', { className: 'lg:hidden sticky top-0 z-30 bg-neutral-950/80 backdrop-blur-md border-b border-neutral-800 px-4 py-3' },
        h('div', { className: 'flex items-center justify-between' },
          h('button', {
            className: 'text-neutral-400 hover:text-white p-1',
            onClick: function() { setSidebarOpen(true); }
          }, h(IconMenu, { size: 22 })),
          h('div', { className: 'flex items-center gap-2' },
            h(IconShield, { size: 18, className: 'text-green-500' }),
            h('span', { className: 'font-semibold text-white text-sm' }, currentNav ? currentNav.label : 'ExploitGuard')
          ),
          h('div', { className: 'w-8' })
        )
      ),

      // Page content
      h('main', { className: 'p-4 md:p-6 lg:p-8 max-w-6xl' },
        renderPage()
      )
    )
  );
}

// ============================================================
// RENDER
// ============================================================

var root = ReactDOM.createRoot(document.getElementById('root'));
root.render(h(App));

