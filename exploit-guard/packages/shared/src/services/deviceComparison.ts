import type { DeviceProfile } from '../models/types';

/**
 * Device security database with known device profiles
 */
const DEVICE_DATABASE: DeviceProfile[] = [
  // Google Pixel
  { brand: 'Google', model: 'Pixel 9 Pro', osVersion: '15', patchLevel: '2025-05-01', securityScore: 95, knownVulnerabilities: 1, updateFrequency: 'MONTHLY', supportedUntil: '2031-10' },
  { brand: 'Google', model: 'Pixel 9', osVersion: '15', patchLevel: '2025-05-01', securityScore: 94, knownVulnerabilities: 1, updateFrequency: 'MONTHLY', supportedUntil: '2031-10' },
  { brand: 'Google', model: 'Pixel 8 Pro', osVersion: '15', patchLevel: '2025-05-01', securityScore: 93, knownVulnerabilities: 2, updateFrequency: 'MONTHLY', supportedUntil: '2030-10' },
  { brand: 'Google', model: 'Pixel 8', osVersion: '15', patchLevel: '2025-05-01', securityScore: 92, knownVulnerabilities: 2, updateFrequency: 'MONTHLY', supportedUntil: '2030-10' },
  { brand: 'Google', model: 'Pixel 7', osVersion: '15', patchLevel: '2025-04-01', securityScore: 88, knownVulnerabilities: 3, updateFrequency: 'MONTHLY', supportedUntil: '2027-10' },
  { brand: 'Google', model: 'Pixel 6', osVersion: '15', patchLevel: '2025-03-01', securityScore: 82, knownVulnerabilities: 4, updateFrequency: 'QUARTERLY', supportedUntil: '2027-06' },

  // Samsung Galaxy
  { brand: 'Samsung', model: 'Galaxy S25 Ultra', osVersion: '15', patchLevel: '2025-05-01', securityScore: 93, knownVulnerabilities: 1, updateFrequency: 'MONTHLY', supportedUntil: '2031-01' },
  { brand: 'Samsung', model: 'Galaxy S25', osVersion: '15', patchLevel: '2025-05-01', securityScore: 92, knownVulnerabilities: 2, updateFrequency: 'MONTHLY', supportedUntil: '2031-01' },
  { brand: 'Samsung', model: 'Galaxy S24 Ultra', osVersion: '15', patchLevel: '2025-04-01', securityScore: 90, knownVulnerabilities: 2, updateFrequency: 'MONTHLY', supportedUntil: '2030-01' },
  { brand: 'Samsung', model: 'Galaxy S24', osVersion: '15', patchLevel: '2025-04-01', securityScore: 89, knownVulnerabilities: 3, updateFrequency: 'MONTHLY', supportedUntil: '2030-01' },
  { brand: 'Samsung', model: 'Galaxy S23', osVersion: '14', patchLevel: '2025-03-01', securityScore: 85, knownVulnerabilities: 4, updateFrequency: 'MONTHLY', supportedUntil: '2028-02' },
  { brand: 'Samsung', model: 'Galaxy A54', osVersion: '14', patchLevel: '2025-02-01', securityScore: 80, knownVulnerabilities: 5, updateFrequency: 'QUARTERLY', supportedUntil: '2027-03' },

  // OnePlus
  { brand: 'OnePlus', model: 'OnePlus 13', osVersion: '15', patchLevel: '2025-04-01', securityScore: 88, knownVulnerabilities: 3, updateFrequency: 'MONTHLY', supportedUntil: '2029-01' },
  { brand: 'OnePlus', model: 'OnePlus 12', osVersion: '15', patchLevel: '2025-03-01', securityScore: 85, knownVulnerabilities: 4, updateFrequency: 'QUARTERLY', supportedUntil: '2028-01' },

  // Xiaomi
  { brand: 'Xiaomi', model: 'Xiaomi 15 Pro', osVersion: '15', patchLevel: '2025-04-01', securityScore: 85, knownVulnerabilities: 3, updateFrequency: 'MONTHLY', supportedUntil: '2029-01' },
  { brand: 'Xiaomi', model: 'Xiaomi 14', osVersion: '14', patchLevel: '2025-02-01', securityScore: 80, knownVulnerabilities: 5, updateFrequency: 'QUARTERLY', supportedUntil: '2027-02' },
  { brand: 'Xiaomi', model: 'Redmi Note 13', osVersion: '14', patchLevel: '2025-01-01', securityScore: 72, knownVulnerabilities: 6, updateFrequency: 'QUARTERLY', supportedUntil: '2027-01' },

  // Apple (for comparison)
  { brand: 'Apple', model: 'iPhone 16 Pro', osVersion: 'iOS 18', patchLevel: '2025-05-01', securityScore: 96, knownVulnerabilities: 1, updateFrequency: 'MONTHLY', supportedUntil: '2030-09' },
  { brand: 'Apple', model: 'iPhone 15', osVersion: 'iOS 18', patchLevel: '2025-05-01', securityScore: 95, knownVulnerabilities: 1, updateFrequency: 'MONTHLY', supportedUntil: '2029-09' },
  { brand: 'Apple', model: 'iPhone 14', osVersion: 'iOS 18', patchLevel: '2025-04-01', securityScore: 93, knownVulnerabilities: 2, updateFrequency: 'MONTHLY', supportedUntil: '2028-09' },
  { brand: 'Apple', model: 'iPhone 13', osVersion: 'iOS 17', patchLevel: '2025-03-01', securityScore: 88, knownVulnerabilities: 3, updateFrequency: 'MONTHLY', supportedUntil: '2027-09' },

  // Nothing
  { brand: 'Nothing', model: 'Nothing Phone 2a', osVersion: '14', patchLevel: '2025-02-01', securityScore: 78, knownVulnerabilities: 5, updateFrequency: 'QUARTERLY', supportedUntil: '2027-03' },

  // Motorola
  { brand: 'Motorola', model: 'Edge 50 Pro', osVersion: '14', patchLevel: '2025-01-01', securityScore: 75, knownVulnerabilities: 6, updateFrequency: 'QUARTERLY', supportedUntil: '2027-04' },

  // Older/EOL devices
  { brand: 'Samsung', model: 'Galaxy S20', osVersion: '13', patchLevel: '2024-10-01', securityScore: 55, knownVulnerabilities: 9, updateFrequency: 'EOL', supportedUntil: '2024-10' },
  { brand: 'Google', model: 'Pixel 4', osVersion: '13', patchLevel: '2023-06-01', securityScore: 35, knownVulnerabilities: 12, updateFrequency: 'EOL', supportedUntil: '2023-06' },
  { brand: 'Huawei', model: 'P30 Pro', osVersion: '12', patchLevel: '2023-01-01', securityScore: 25, knownVulnerabilities: 15, updateFrequency: 'EOL', supportedUntil: '2022-12' },
];

/**
 * Get all devices for comparison
 */
export function getAllDevices(): DeviceProfile[] {
  return [...DEVICE_DATABASE].sort((a, b) => b.securityScore - a.securityScore);
}

/**
 * Get devices by brand
 */
export function getDevicesByBrand(brand: string): DeviceProfile[] {
  return DEVICE_DATABASE.filter((d) => d.brand.toLowerCase() === brand.toLowerCase())
    .sort((a, b) => b.securityScore - a.securityScore);
}

/**
 * Compare two devices
 */
export function compareDevices(device1: string, device2: string): {
  device1: DeviceProfile | null;
  device2: DeviceProfile | null;
  winner: string;
  comparison: { category: string; device1Value: string; device2Value: string; winner: 1 | 2 | 0 }[];
} {
  const d1 = DEVICE_DATABASE.find((d) => d.model.toLowerCase() === device1.toLowerCase()) || null;
  const d2 = DEVICE_DATABASE.find((d) => d.model.toLowerCase() === device2.toLowerCase()) || null;

  if (!d1 || !d2) {
    return { device1: d1, device2: d2, winner: 'Unknown', comparison: [] };
  }

  const comparison = [
    {
      category: 'Security Score',
      device1Value: `${d1.securityScore}/100`,
      device2Value: `${d2.securityScore}/100`,
      winner: (d1.securityScore > d2.securityScore ? 1 : d1.securityScore < d2.securityScore ? 2 : 0) as 1 | 2 | 0,
    },
    {
      category: 'OS Version',
      device1Value: d1.osVersion,
      device2Value: d2.osVersion,
      winner: (d1.osVersion > d2.osVersion ? 1 : d1.osVersion < d2.osVersion ? 2 : 0) as 1 | 2 | 0,
    },
    {
      category: 'Known Vulnerabilities',
      device1Value: `${d1.knownVulnerabilities}`,
      device2Value: `${d2.knownVulnerabilities}`,
      winner: (d1.knownVulnerabilities < d2.knownVulnerabilities ? 1 : d1.knownVulnerabilities > d2.knownVulnerabilities ? 2 : 0) as 1 | 2 | 0,
    },
    {
      category: 'Update Frequency',
      device1Value: d1.updateFrequency,
      device2Value: d2.updateFrequency,
      winner: (updateFreqScore(d1.updateFrequency) > updateFreqScore(d2.updateFrequency) ? 1 : updateFreqScore(d1.updateFrequency) < updateFreqScore(d2.updateFrequency) ? 2 : 0) as 1 | 2 | 0,
    },
    {
      category: 'Support End Date',
      device1Value: d1.supportedUntil || 'Unknown',
      device2Value: d2.supportedUntil || 'Unknown',
      winner: ((d1.supportedUntil || '') > (d2.supportedUntil || '') ? 1 : (d1.supportedUntil || '') < (d2.supportedUntil || '') ? 2 : 0) as 1 | 2 | 0,
    },
  ];

  const d1Wins = comparison.filter((c) => c.winner === 1).length;
  const d2Wins = comparison.filter((c) => c.winner === 2).length;

  return {
    device1: d1,
    device2: d2,
    winner: d1Wins > d2Wins ? d1.model : d2Wins > d1Wins ? d2.model : 'Tie',
    comparison,
  };
}

function updateFreqScore(freq: DeviceProfile['updateFrequency']): number {
  switch (freq) {
    case 'MONTHLY': return 4;
    case 'QUARTERLY': return 3;
    case 'YEARLY': return 2;
    case 'IRREGULAR': return 1;
    case 'EOL': return 0;
  }
}

/**
 * Get top secure devices
 */
export function getTopSecureDevices(limit: number = 10): DeviceProfile[] {
  return [...DEVICE_DATABASE]
    .sort((a, b) => b.securityScore - a.securityScore)
    .slice(0, limit);
}

/**
 * Search devices by query
 */
export function searchDevices(query: string): DeviceProfile[] {
  const q = query.toLowerCase();
  return DEVICE_DATABASE.filter(
    (d) => d.brand.toLowerCase().includes(q) || d.model.toLowerCase().includes(q)
  );
}

/**
 * Get unique brands
 */
export function getAvailableBrands(): string[] {
  return [...new Set(DEVICE_DATABASE.map((d) => d.brand))].sort();
}
